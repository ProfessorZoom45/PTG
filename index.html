<!DOCTYPE html>
<html lang="en" id="top">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Running Late Dynasty</title>
  <meta name="description" content="Running Late Dynasty — splash with ticker, quick links, and auto-redirect to the newest issue." />
  <meta name="color-scheme" content="dark" />

  <!-- Canonical -->
  <link rel="canonical" href="https://professorzoom45.github.io/PTG/">

  <!-- Social / OG -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Perfect Timing Gaming">
  <meta property="og:title" content="Running Late Dynasty — D1SN">
  <meta property="og:description" content="Live ticker with Top-5, recent user-vs-user results, and quick links to the latest issue.">
  <meta property="og:url" content="https://professorzoom45.github.io/PTG/">
  <meta property="og:image" content="https://professorzoom45.github.io/PTG/Oh.PNG">
  <meta property="og:image:secure_url" content="https://professorzoom45.github.io/PTG/Oh.PNG">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#d5b15b">

  <!-- Icons / PWA -->
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
  <link rel="icon" href="assets/favicon.ico" sizes="any">
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.PNG">
  <link rel="manifest" href="assets/site.webmanifest">

  <!-- Fonts (sporty display for headings) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

  <!-- Warm next pages -->
  <link rel="prefetch" href="issue03.html" as="document" />
  <link rel="prefetch" href="issue04.html" as="document" />
  <link rel="prefetch" href="teamhub.html" as="document" />
  <link rel="prefetch" href="coaches.html" as="document" />
  <link rel="prefetch" href="confbatt.html" as="document" />
  <link rel="prefetch" href="boost.html" as="document" />
  <link rel="prefetch" href="polls.html" as="document" />
  <link rel="prefetch" href="standings.html" as="document" />
  <link rel="preload" as="image" href="Oh.PNG" />

  <style>
    :root{
      --bg:#0b0b0b;--card:#141414;--line:#232323;--text:#e6e6e6;--muted:#a6a6a6;
      --gold:#d5b15b;--accent:#f2d675;
      --chip:#121212;--chip-b:#2a2a2a;
      --btn-a:#1a1a1a;--btn-b:#262626;--btn-glow:#f2d67566
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:var(--gold);text-decoration:none}
    a:focus-visible,.cta-btn:focus-visible,.stay-btn:focus-visible{outline:2px solid var(--accent);outline-offset:2px;border-radius:10px}

    h1,h2{font-family:"Anton",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; letter-spacing:.4px}

    /* Ticker */
    .ticker{position:sticky;top:0;z-index:999;background:linear-gradient(90deg,#121212,#181818);border-bottom:1px solid #1f1f1f}
    .ticker .wrap{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:10px;padding:10px 14px}
    .logo-a{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:10px;background:linear-gradient(180deg,#f7e8a5,#d6b458 60%,#a3832c);color:#111;font-weight:900;letter-spacing:.6px;border:1px solid #caae51;box-shadow:0 0 0 2px #3c3210 inset, 0 2px 10px #0008;white-space:nowrap}
    .track{overflow:hidden;flex:1;min-width:280px}
    .row{display:inline-flex;gap:28px;align-items:center;white-space:nowrap;animation:marquee 28s linear infinite}
    .row.paused{animation-play-state:paused}
    .row>*{font-weight:900;letter-spacing:.3px;position:relative;padding-right:36px;margin-right:36px}
    .row>*::after{content:"";position:absolute;right:8px;top:50%;transform:translateY(-50%);width:6px;height:24px;background:linear-gradient(180deg,#f7e8a5,#d6b458 60%,#a3832c);border-radius:3px}
    @keyframes marquee{from{transform:translateX(0)} to{transform:translateX(-50%)}}
    @media (prefers-reduced-motion:reduce){ .row{animation:none !important} }

    /* Splash */
    .splash{min-height:66vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;color:var(--accent);position:relative;padding:18px 14px}
    /* Vignette + subtle film grain */
    .splash::before{
      content:""; position:absolute; inset:0; pointer-events:none;
      background:radial-gradient(120% 80% at 50% 40%, transparent 55%, rgba(0,0,0,.35) 100%);
      mix-blend-mode:multiply;
    }
    .splash::after{
      content:""; position:absolute; inset:0; pointer-events:none; opacity:.06;
      background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/><feColorMatrix type='saturate' values='0'/></filter><rect width='100%' height='100%' filter='url(%23n)'/></svg>");
      background-size:300px 300px; background-repeat:repeat;
    }

    .splash h1{margin:0 0 8px;font-size:clamp(1.8rem,5vw,3rem)}
    .splash-hero{width:min(100%,1100px);max-width:92vw;height:auto;margin:.75rem auto;border-radius:16px;border:1px solid #2a2a2a;box-shadow:0 10px 40px #000a}
    .note{max-width:1100px;margin:8px auto 0;color:var(--muted)}
    .cta-rows{display:grid;gap:10px;margin-top:10px}
    .row-btns{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    .cta-btn{border:1px solid #3c3c3c;padding:10px 14px;border-radius:12px;color:#fff;background:linear-gradient(180deg,var(--btn-a),var(--btn-b));box-shadow:0 0 0 2px #000 inset, 0 0 18px var(--btn-glow);font-weight:800;letter-spacing:.2px;position:relative;overflow:hidden}
    .cta-btn.primary{box-shadow:0 0 0 2px #000 inset, 0 0 26px var(--btn-glow)}
    /* Animated gold underline on the primary button */
    .cta-btn.primary::after{
      content:""; position:absolute; left:12px; right:12px; bottom:8px; height:2px;
      background:linear-gradient(90deg,transparent, var(--gold), transparent);
      transform:scaleX(0); transform-origin:center; transition:transform .28s ease;
      border-radius:2px;
    }
    .cta-btn.primary:hover::after,
    .cta-btn.primary:focus-visible::after{ transform:scaleX(1); }

    .stay-btn{border:1px solid var(--chip-b);background:#101010;border-radius:12px;padding:10px 14px;color:#eaeaea;font-weight:800}
    .count{font-variant-numeric:tabular-nums}

    /* Footer */
    footer{max-width:1100px;margin:24px auto 40px;padding:0 14px;color:#bdbdbd;font-size:.95rem;display:grid;gap:8px;text-align:center}
    footer .links{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
    footer a{color:var(--accent)}
  </style>
</head>
<body>

  <!-- Ticker (auto-built from polls.html JSON + week arrays) -->
  <div class="ticker" role="region" aria-label="D1SN headlines">
    <div class="wrap">
      <a href="#top" class="logo-a" title="Home">D1SN</a>
      <div class="track" aria-live="polite">
        <div class="row" id="tickerRow">
          <span>Loading ticker…</span>
          <span aria-hidden="true">Loading ticker…</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Splash -->
  <section class="splash" aria-label="cover">
    <h1>Running Late Dynasty</h1>

    <!-- Hero image: ALWAYS link to Oh.PNG in the root -->
    <a href="Oh.PNG" target="_blank" title="Open cover (Oh.PNG)">
      <img class="splash-hero" src="Oh.PNG" alt="Running Late hero cover" width="1600" height="900" fetchpriority="high" />
    </a>

    <p class="note">
      Auto-redirecting to <strong>latest issue</strong> in <span id="count" class="count" aria-live="polite">9</span>s…
    </p>

    <!-- Buttons (organized) -->
    <div class="cta-rows" role="navigation" aria-label="Quick Links">
      <!-- Row 1: Latest (alone) -->
      <div class="row-btns">
        <a class="cta-btn primary" id="readNow" href="issue01.html" title="Open Latest Issue (detected)">Open Latest Issue</a>
      </div>

      <!-- Row 2: Polls + Standings -->
      <div class="row-btns">
        <a class="cta-btn" href="polls.html" title="Polls & Power Index">Polls & Power Index</a>
        <a class="cta-btn" href="standings.html" title="Standings">Standings</a>
      </div>

      <!-- Row 3: Directories / Events / Tools -->
      <div class="row-btns">
        <a class="cta-btn" href="teamhub.html" title="Browse Team Pages">Team Pages</a>
        <a class="cta-btn" href="coaches.html" title="Schools Page">Schools</a>
        <a class="cta-btn" href="confbatt.html" title="Conference Battle">Conference Battle</a>
        <a class="cta-btn" href="boost.html" title="Dynasty Boost Tracker">Dynasty Boost</a>
      </div>

      <!-- Row 4: Past Issues (auto-filled, above Stay Here). Includes explicit Issue 04 link as fallback. -->
      <div class="row-btns" id="issuesRow" aria-label="Past Issues">
        <a class="cta-btn" href="issue04.html" title="Open Issue 04">Issue 04</a>
      </div>

      <!-- Row 5: Stay Here (alone) -->
      <div class="row-btns">
        <button class="stay-btn" id="stayBtn" type="button" title="Stay on the splash page">Stay Here</button>
      </div>
    </div>
  </section>

  <!-- Compact footer -->
  <footer>
    <div>© D1SN — Running Late Dynasty</div>
    <div class="links">
      <a href="polls.html" title="See rankings and the user-only Power Index">About D1SN</a> •
      <a href="mailto:changethewrldplz@gmail.com" title="Email D1SN">Contact</a> •
      <a href="https://discord.gg/8GfXM4EWVX" target="_blank" rel="noopener" title="Join the league on Discord">How to join</a>
    </div>
  </footer>

  <script>
    // ---------- Settings ----------
    const STAY_KEY = 'rl_splash_stay';
    const DEFAULT_LATEST = 'issue01.html';     // Safe fallback
    const MAX_ISSUE_SCAN = 99;                 // Scan issue01 → issue99 for future-proofing

    // Pause ticker on hover/focus for better interaction
    (function setupTickerPause(){
      const row = document.getElementById('tickerRow');
      if(!row) return;
      const on = ()=> row.classList.add('paused');
      const off= ()=> row.classList.remove('paused');
      row.addEventListener('mouseenter', on);
      row.addEventListener('mouseleave', off);
      row.addEventListener('focusin', on);
      row.addEventListener('focusout', off);
    })();

    // ---------- Latest issue detection (contiguous scan) ----------
    async function detectLatestIssue(){
      let lastOk = null;
      for(let i = 1; i <= MAX_ISSUE_SCAN; i++){
        const n = String(i).padStart(2,'0');
        const href = `issue${n}.html`;
        try{
          const res = await fetch(href + '?chk=' + Date.now(), {cache:'no-store'});
          if(res.ok) lastOk = href; else break;  // stop at first gap
        }catch(_e){ break; }
      }
      return lastOk || DEFAULT_LATEST;
    }

    // Fill the "Past Issues" row dynamically from 01..latest
    function renderIssuesRow(latestHref){
      const row = document.getElementById('issuesRow');
      if(!row) return;
      const latestNum = +latestHref.match(/issue(\d+)\.html/i)[1];
      let html = '';
      for(let i = 1; i <= latestNum; i++){
        const n = String(i).padStart(2,'0');
        html += `<a class="cta-btn" href="issue${n}.html" title="Open Issue ${n}">Issue ${n}</a>`;
      }
      row.innerHTML = html;
    }

    // Update "Open Latest Issue" button + countdown target and issues list
    let LATEST_HREF = DEFAULT_LATEST;
    (async () => {
      LATEST_HREF = await detectLatestIssue();
      const readNow = document.getElementById('readNow');
      if(readNow) readNow.href = LATEST_HREF;
      renderIssuesRow(LATEST_HREF);
    })();

    // ---------- Countdown ----------
    (function countdown(){
      const qs = new URLSearchParams(location.search);
      const tParam = parseInt(qs.get('t') || '', 10);
      let t = Number.isFinite(tParam) ? Math.max(0, tParam) : 9;
      if (qs.get('stay') === '1') localStorage.setItem(STAY_KEY, '1');

      const stayed  = localStorage.getItem(STAY_KEY) === '1';
      const countEl = document.getElementById('count');
      const stayBtn = document.getElementById('stayBtn');
      const readNow = document.getElementById('readNow');

      let canceled = stayed;
      if (stayed) countEl.textContent = '—';

      stayBtn.addEventListener('click', () => {
        canceled = true;
        localStorage.setItem(STAY_KEY, '1');
        countEl.textContent = '—';
      });
      readNow.addEventListener('click', () => { canceled = true; });

      const tick = () => {
        if (canceled) return;
        countEl.textContent = t;
        if (t <= 0) location.href = LATEST_HREF || DEFAULT_LATEST;
        else { t -= 1; setTimeout(tick, 1000); }
      };
      if (!canceled) setTimeout(tick, 1000);
    })();

    // ---------- Helpers to parse week arrays out of polls.html ----------
    function extractArray(name, html){
      // Correct regex: matches "const NAME = [ ... ];"
      const rx = new RegExp(String.raw`const\\s+${name}\\s*=\\s*\$begin:math:display$([\\\\s\\\\S]*?)\\$end:math:display$;`);
      const m = rx.exec(html);
      if(!m) return [];
      // Make it valid JSON by quoting object keys if needed
      let js = `[${m[1]}]`.replace(/([{,]\\s*)([A-Za-z_]\\w*)\\s*:/g, '$1"$2":');
      try { return JSON.parse(js); } catch { return []; }
    }

    // ---------- Ticker: Top-5 + recent UvU pulled from polls.html ----------
    async function buildTicker(){
      const row = document.getElementById('tickerRow');

      const fallback = [
        'Top-5 loading…',
        'Recent UvU loading…'
      ];
      const render = (items)=> {
        // Duplicate 3x for smoother loop
        const triple = items.concat(items).concat(items);
        row.innerHTML = triple.map((t,i)=>`<span${i>=items.length?' aria-hidden="true"':''}>${t}</span>`).join('');
      };

      try{
        const res = await fetch('polls.html', {cache:'no-store'});
        if(!res.ok) throw new Error('polls fetch failed');
        const html = await res.text();

        // grab exported JSON (authoritative for ranks + user flags)
        const doc  = new DOMParser().parseFromString(html,'text/html');
        const jsonEl = doc.querySelector('#d1sn-polls-data');
        if(!jsonEl || !jsonEl.textContent.trim()) throw new Error('polls json missing');
        const data = JSON.parse(jsonEl.textContent);

        const combined = data.polls?.combined || [];
        const top5 = combined.slice(0,5).map(r => `#${r.rank} ${r.team}`);
        const top5Span = `Top-5 (Combined): ${top5.join(' • ')}`;

        // Build rank + user sets (count both active and former as 'user-like' for UvU)
        const rankMap = new Map(combined.map(r => [r.team, r.rank]));
        const active  = new Set((data.flags && data.flags.active_users) || []);
        const former  = new Set((data.flags && data.flags.former_users_with_week ? data.flags.former_users_with_week.map(x=>x[0]) : []));
        const userLike = new Set([...active, ...former]);

        // Scrape week arrays from the same file
        const w6 = extractArray('WEEK6_RESULTS', html);
        const w5 = extractArray('WEEK5_RESULTS', html);

        const isUvU = g => userLike.has(g.away) && userLike.has(g.home);
        const uvuRecent = []
          .concat(w6.filter(isUvU).map(g => ({...g, wk:6})))
          .concat(w5.filter(isUvU).map(g => ({...g, wk:5})));

        const rk = t => {
          const r = rankMap.get(t);
          return (r && r<=25) ? `#${r} ${t}` : t;
        };
        const fmt = g => `W${g.wk}: ${rk(g.away)} ${g.a}–${g.h} at ${rk(g.home)}`;

        const uvuSpan = uvuRecent.length
          ? `Recent UvU: ${uvuRecent.slice(0,4).map(fmt).join(' • ')}`
          : 'Recent UvU: (none logged in W6/W5)';

        render([top5Span, uvuSpan, 'See: Polls & Power Index →']);
      }catch(e){
        render(fallback);
      }
    }
    buildTicker();

    // ---------- Hero image fallback note ----------
    (function heroFallback(){
      const hero = document.querySelector('.splash-hero');
      if(!hero) return;
      hero.addEventListener('error', ()=>{
        const note = document.createElement('div');
        note.className = 'note';
        note.textContent = '(Hero image unavailable — expected Oh.PNG in the repo root)';
        hero.replaceWith(note);
      });
    })();
  </script>
</body>
</html>

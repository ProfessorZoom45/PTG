<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>D1SN ‚Äî Boost Tracker</title>

<!-- THEME: black background, white headings, gold accents -->
<style>
:root{
  --bg:#0b0b0b; --card:#141414; --line:#232323;
  --text:#e6e6e6; --muted:#a6a6a6;
  --gold:#d5b15b; --accent:#f2d675;
  --btn-a:#1a1a1a; --btn-b:#262626; --btn-glow:#f2d67566;
  --win-bg:#143a29; --win-fg:#bff8d7;
  --loss-bg:#3f2629; --loss-fg:#ffd0d0;
  --ok:#20c997;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
h1,h2{color:#fff;margin:0 0 .6rem}
a{color:var(--gold);text-decoration:none}
.section{max-width:1200px;margin:0 auto;padding:18px 14px}
.card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px}
.small{font-size:.92rem;color:#b0b0b0}
.muted{color:var(--muted)}
.grid{display:grid;gap:14px;grid-template-columns:1fr}
@media(min-width:1100px){.grid{grid-template-columns:1fr 1fr}}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #2a2a2a;padding:8px 10px;text-align:left;vertical-align:top}
.table th{color:#fff}
.cell-win{background:var(--win-bg);color:var(--win-fg);border-radius:6px;padding:3px 8px}
.cell-loss{background:var(--loss-bg);color:var(--loss-fg);border-radius:6px;padding:3px 8px}

/* Ticker */
.ticker{position:sticky;top:0;z-index:999;background:linear-gradient(90deg,#121212,#181818);border-bottom:1px solid #1f1f1f}
.twrap{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:10px;padding:10px 14px;flex-wrap:wrap}
.tlogo{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:10px;background:linear-gradient(180deg,#f7e8a5,#d6b458 60%,#a3832c);color:#111;font-weight:900;letter-spacing:.6px;border:1px solid #caae51}
.track{overflow:hidden;flex:1;min-width:280px}
.row{display:inline-flex;gap:28px;align-items:center;white-space:nowrap;animation:marquee 30s linear infinite}
.row:hover{animation-play-state:paused}
.row>*{font-weight:900;letter-spacing:.3px;position:relative;padding-right:36px;margin-right:36px}
.row>*::after{content:"";position:absolute;right:8px;top:50%;transform:translateY(-50%);width:6px;height:24px;background:linear-gradient(180deg,#f7e8a5,#d6b458 60%,#a3832c);border-radius:3px}
@keyframes marquee{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.cta{margin-left:8px;border:1px solid #3c3c3c;padding:8px 14px;border-radius:12px;color:#fff;background:linear-gradient(180deg,var(--btn-a),var(--btn-b));box-shadow:0 0 0 2px #000 inset, 0 0 18px var(--btn-glow);font-weight:800;letter-spacing:.2px}

/* Completion grid */
.comp-wrap{overflow:auto}
.comp{min-width:820px;border-collapse:collapse;width:100%}
.comp th,.comp td{border-bottom:1px solid #2a2a2a;padding:8px 10px;text-align:center}
.comp th.sticky{position:sticky;left:0;background:var(--card);z-index:1;text-align:left}
.comp td.sticky{position:sticky;left:0;background:var(--card);text-align:left}
.dot{display:inline-block;width:20px;height:20px;line-height:20px;border-radius:6px;background:#1c1c1c;border:1px solid #333}
.dot.done{background:var(--ok);color:#041;font-weight:700}
.dot.blank{opacity:.25}
.total{font-weight:800;color:var(--accent)}
.badge{display:inline-block;border:1px solid #3a3a3a;background:#111;padding:2px 8px;border-radius:999px;font-size:.8rem;margin-left:8px}
</style>
</head>
<body>

<!-- TICKER -->
<div class="ticker">
  <div class="twrap">
    <span class="tlogo">D1SN</span>
    <div class="track"><div class="row" id="tickerRow"><span>Loading ranked finals‚Ä¶</span></div></div>
    <a class="cta" href="#announcement">Boost Announcement</a>
  </div>
</div>

<section class="section">
  <h1>Boost Tracker</h1>
  <div class="card">
    <p>Tracks completed <strong>User vs User</strong> and <strong>User vs CPU</strong> games. Ranks are shown next to school names. The ticker shows only <em>completed user games where both teams were ranked</em> at kickoff.</p>
    <p class="small muted">Bracket (Top 5 / 10 / 15 / 25) uses the <em>worst</em> of the two ranks (e.g., <strong>#6 Alabama @ #2 Ohio State</strong> ‚áí <strong>Top 10</strong>).</p>
  </div>
</section>

<section class="section grid">
  <div class="card">
    <h2>Completed ‚Äî User vs User <span class="badge">Users</span></h2>
    <table class="table">
      <thead><tr><th>Away</th><th>A</th><th>Home</th><th>H</th><th>Week</th><th>Bracket</th></tr></thead>
      <tbody id="uvuBody"></tbody>
    </table>
  </div>
  <div class="card">
    <h2>Completed ‚Äî User vs CPU <span class="badge">Users</span></h2>
    <table class="table">
      <thead><tr><th>Away</th><th>A</th><th>Home</th><th>H</th><th>Week</th><th>Bracket</th></tr></thead>
      <tbody id="uvcpuBody"></tbody>
    </table>
  </div>
</section>

<section class="section">
  <h2>‚úÖ User Completion Grid <span class="badge">Week 6 = Free Credit</span></h2>
  <div class="card comp-wrap">
    <table class="comp" id="compTable">
      <thead id="compHead"></thead>
      <tbody id="compBody"></tbody>
    </table>
    <p class="small muted" style="margin-top:8px">
      ‚úì = reported final that week. Week 6 is credited to <em>everyone</em>.  
      New users (Ole Miss, Georgia Tech, Oregon) joined in Week 6 and may miss at most <strong>one</strong> week from Week 6 and beyond.
    </p>
  </div>
</section>

<section id="announcement" class="section">
  <h2>üèÜ Game of the Week ‚Äì Boost Announcement</h2>
  <div class="card">
    <p>This week‚Äôs Game of the Week has been decided, and with it comes exclusive boost rewards for the winner and their supporters.</p>

    <p><strong>üìã Boost Rules Recap:</strong><br>
      ‚Ä¢ Boosts apply only to true freshmen.<br>
      ‚Ä¢ üö´ No stacking rewards or boosting the same player more than +5 in one attribute.<br>
      ‚Ä¢ Must Vote Before The Game Starts!
    </p>

    <p>Supporters can also claim a reward by voting in Discord for their pick.</p>

    <hr style="border:0;border-top:1px solid var(--line);margin:10px 0"/>

    <p><strong>üéØ Boost Breakdown by Matchup Ranking:</strong><br>
      ‚Ä¢ Top 5 Matchup: Winner +5 Awareness | Supporters +1 Awareness<br>
      ‚Ä¢ Top 10 Matchup: Winner +4 Awareness | Supporters +1 Awareness<br>
      ‚Ä¢ Top 15 Matchup: Winner +3 Awareness | Supporters +1 Awareness<br>
      ‚Ä¢ All Other Matchups: Winner +2 Awareness | Supporters +1 Awareness
    </p>

    <hr style="border:0;border-top:1px solid var(--line);margin:10px 0"/>

    <p><strong>üî• This Week‚Äôs Featured Game:</strong><br>
      #6 Alabama @ #2 Ohio State (Top 10 Matchup)<br>
      ‚Ä¢ Winner: +4 Awareness to a true freshman<br>
      ‚Ä¢ Supporters: +1 Awareness to their freshman of choice
    </p>

    <hr style="border:0;border-top:1px solid var(--line);margin:10px 0"/>

    <p><strong>üì¢ Cast your votes in the Running Late Dynasty Discord:</strong><br>
      üëâ <a href="https://discord.com/channels/1382826467683205180/1407980310158905448" target="_blank" rel="noopener">Cast Your Vote üó≥Ô∏è</a></p>

    <p>The winning coach‚Äôs supporters will also be rewarded!</p>

    <hr style="border:0;border-top:1px solid var(--line);margin:10px 0"/>

    <p><strong>‚ö†Ô∏è Note:</strong> Moving forward, Game of the Week will be selected by admins after each advance.</p>
  </div>
</section>

<!-- Compatibility: if your host page provides <script id="d1sn-polls-data"> it will override fallback. -->
<script type="application/json" id="d1sn-polls-data-EXAMPLE" style="display:none">
{
  "pre":[[1,"Georgia"],[2,"Ohio State"],[3,"Notre Dame"],[4,"Texas"],[5,"Alabama"],
         [6,"North Carolina"],[7,"Miami"],[8,"Penn State"],[9,"LSU"],[10,"Clemson"],
         [11,"Minnesota"],[12,"USC"],[13,"Texas Tech"],[14,"Florida State"],[15,"Oklahoma"],
         [16,"Florida"],[17,"Washington"],[18,"Baylor"],[19,"Tennessee"],[20,"Texas A&M"],
         [21,"Colorado"],[22,"Arkansas"],[23,"BYU"],[24,"Utah"],[25,"Illinois"]],
  "now":[[1,"Alabama"],[2,"Miami"],[3,"South Carolina"],[4,"Notre Dame"],[5,"North Carolina"],
         [6,"Ohio State"],[7,"Minnesota"],[8,"Penn State"],[9,"LSU"],[10,"Georgia"],
         [11,"Texas"],[12,"BYU"],[13,"Washington"],[14,"Colorado"],[15,"Texas Tech"],
         [16,"Michigan"],[17,"SMU"],[18,"Indiana"],[19,"Oregon"],[20,"Texas A&M"],
         [21,"Baylor"],[22,"Delaware"],[23,"Utah"],[24,"Arkansas"],[25,"Florida"]]
}
</script>

<script>
/* ===== USERS (32 + 3 late-joiners) ===== */
const CORE_USERS=[
  "LSU","Clemson","Arkansas","Michigan","Texas","Ohio State","Miami","Delaware",
  "Georgia","Arizona State","Florida","Washington","Alabama","BYU","Oklahoma",
  "Florida State","Notre Dame","South Carolina","Illinois","USC","Texas Tech",
  "Baylor","Colorado","Texas A&M","Penn State","Tennessee","North Carolina",
  "Utah","Auburn","Minnesota","SMU","UCLA"
];

// Late joiners begin counting as users in Week 6 (and get Week 6 credit).
const LATE_JOINERS={"Ole Miss":6,"Georgia Tech":6,"Oregon":6};

// Union of all users
const ALL_USERS=[...CORE_USERS, ...Object.keys(LATE_JOINERS)];

/* ===== Polls: load external JSON if present ===== */
function loadPolls(){
  const el = document.getElementById('d1sn-polls-data') || document.getElementById('d1sn-polls-data-EXAMPLE');
  let data=null;
  if(el){ try{ data = JSON.parse(el.textContent.trim()); }catch(e){} }
  return (data && data.pre && data.now) ? data
        : JSON.parse(document.getElementById('d1sn-polls-data-EXAMPLE').textContent);
}
const POLLS = loadPolls();
const PRE = new Map(POLLS.pre.map(([r,t])=>[t,r]));
const NOW = new Map(POLLS.now.map(([r,t])=>[t,r]));

/* Helpers */
const weekNum = label => Number(String(label).replace(/[^0-9]/g,"")) || 0;
const rankAt=(team,tag)=> (tag==="now"?NOW:PRE).get(team)||null;
const joinedBy = (team,wNum) => {
  const j = LATE_JOINERS[team] ?? 0; // 0 = from start
  return wNum >= j;
};
const isUserAtWeek = (team,wNum) => ALL_USERS.includes(team) && joinedBy(team,wNum);

function bracketFrom(ar,br){
  if(ar==null && br==null) return null;
  const worst = Math.max(ar??0, br??0) || null;
  if(worst==null) return null;
  if(worst<=5) return "Top 5";
  if(worst<=10) return "Top 10";
  if(worst<=15) return "Top 15";
  if(worst<=25) return "Top 25";
  return null;
}

/* ===== RESULTS (Weeks 0‚Äì5 from screenshots) ===== */
const WEEK0=[
  {away:"BYU",a:21,home:"Clemson",h:17},
  {away:"Florida",a:27,home:"Washington",h:42},
  {away:"USC",a:7,home:"Texas",h:40},
  {away:"Miami",a:63,home:"Central Michigan",h:3},
  {away:"Alabama",a:42,home:"Iowa",h:7},
  {away:"LSU",a:26,home:"Indiana",h:24},
  {away:"Penn State",a:57,home:"Temple",h:20},
  {away:"Utah",a:56,home:"Utah State",h:31},
  {away:"UCLA",a:10,home:"California",h:14},
  {away:"Michigan",a:20,home:"Houston",h:0},
  {away:"Baylor",a:37,home:"SMU",h:14}
];
const WEEK1=[
  {away:"Clemson",a:14,home:"LSU",h:31},
  {away:"Georgia",a:26,home:"Miami",h:38},
  {away:"Alabama",a:21,home:"Ohio State",h:14},
  {away:"Arizona State",a:7,home:"South Carolina",h:20},
  {away:"Texas",a:48,home:"Texas State",h:3},
  {away:"Tennessee",a:47,home:"California",h:44},
  {away:"Texas A&M",a:38,home:"Missouri State",h:3},
  {away:"Penn State",a:70,home:"Marshall",h:3},
  {away:"Michigan",a:35,home:"NC State",h:20},
  {away:"Florida State",a:38,home:"Ole Miss",h:24}
];
const WEEK2=[
  {away:"USC",a:13,home:"LSU",h:42},
  {away:"Florida State",a:24,home:"Texas",h:21},
  {away:"Michigan",a:24,home:"Oklahoma",h:10},
  {away:"Arizona State",a:31,home:"Texas A&M",h:13},
  {away:"BYU",a:66,home:"Utah State",h:3},
  {away:"Auburn",a:17,home:"Army",h:7},
  {away:"UCLA",a:31,home:"Kennesaw State",h:7}
];
const WEEK3=[
  {away:"Alabama",a:21,home:"Utah",h:31},
  {away:"LSU",a:28,home:"BYU",h:21},
  {away:"Baylor",a:35,home:"Ohio State",h:41},
  {away:"Washington",a:56,home:"Washington State",h:20},
  {away:"Georgia State",a:21,home:"Georgia",h:56},
  {away:"South Carolina",a:41,home:"Missouri",h:10},
  {away:"Buffalo",a:7,home:"Penn State",h:63},
  {away:"New Mexico",a:21,home:"Oklahoma",h:28},
  {away:"Miami",a:63,home:"Syracuse",h:17},
  {away:"Boston College",a:13,home:"Clemson",h:24},
  {away:"Hawai'i",a:14,home:"Arizona State",h:35},
  {away:"Delaware",a:13,home:"Georgia Tech",h:10}
];
const WEEK4=[
  {away:"Illinois",a:0,home:"North Carolina",h:38},
  {away:"Texas A&M",a:0,home:"Tennessee",h:49},
  {away:"Alabama",a:28,home:"LSU",h:24},
  {away:"Sam Houston",a:6,home:"Texas Tech",h:77},
  {away:"Vanderbilt",a:26,home:"Texas",h:24},
  {away:"Rice",a:14,home:"South Carolina",h:73},
  {away:"Oklahoma",a:0,home:"Ole Miss",h:24},
  {away:"Michigan",a:42,home:"Oregon",h:24},
  {away:"Florida State",a:24,home:"Pittsburgh",h:14},
  {away:"Houston",a:13,home:"Arizona State",h:21}
];
const WEEK5=[
  {away:"North Carolina",a:45,home:"Notre Dame",h:20},
  {away:"Purdue",a:0,home:"Washington",h:49},
  {away:"Oklahoma State",a:24,home:"Texas Tech",h:38},
  {away:"SMU",a:41,home:"Louisville",h:10},
  {away:"Georgia Tech",a:22,home:"Miami",h:48},
  {away:"Tennessee",a:14,home:"Syracuse",h:21},
  {away:"Kansas State",a:7,home:"BYU",h:63}
];

// Week 6 = Free Week (no games; auto-credit for everyone)
const WEEK6=[];

const WEEKS=[
  {wk:"Week 0",poll:"pre",games:WEEK0},
  {wk:"Week 1",poll:"pre",games:WEEK1},
  {wk:"Week 2",poll:"now",games:WEEK2},
  {wk:"Week 3",poll:"now",games:WEEK3},
  {wk:"Week 4",poll:"now",games:WEEK4},
  {wk:"Week 5",poll:"now",games:WEEK5},
  {wk:"Week 6",poll:"now",games:WEEK6} // free credit
];

/* Build tables + ticker + completion grid */
const uvuBody=document.getElementById('uvuBody');
const uvcpuBody=document.getElementById('uvcpuBody');
const tickerRow=document.getElementById('tickerRow');

const completions = new Map(ALL_USERS.map(t=>[t,new Set()]));
const weekLabels = WEEKS.map(w=>w.wk);

// process results
WEEKS.forEach(({wk,poll,games})=>{
  const wNum = weekNum(wk);
  // auto-credit Week 6 for all who have joined by Week 6
  if(wNum===6){
    ALL_USERS.forEach(team=>{
      if(joinedBy(team,6)) completions.get(team).add(wk);
    });
  }
  games.forEach(g=>{
    const A=g.away,H=g.home,a=g.a,h=g.h;
    const Auser=isUserAtWeek(A,wNum), Huser=isUserAtWeek(H,wNum);
    if(!(Auser||Huser)) return; // ignore CPU vs CPU for tracking

    // mark completion for users who have joined
    if(Auser) completions.get(A).add(wk);
    if(Huser) completions.get(H).add(wk);

    const ar=rankAt(A,poll), br=rankAt(H,poll);
    const bracket = bracketFrom(ar,br);
    const rowHtml = `
      <tr>
        <td class="${a>h?'cell-win':'cell-loss'}">${ar?`#${ar} `:''}${A}</td>
        <td class="${a>h?'cell-win':'cell-loss'}">${a}</td>
        <td class="${h>a?'cell-win':'cell-loss'}">${br?`#${br} `:''}${H}</td>
        <td class="${h>a?'cell-win':'cell-loss'}">${h}</td>
        <td>${wk}</td>
        <td>${bracket||'‚Äî'}</td>
      </tr>`;
    if(Auser && Huser) uvuBody.insertAdjacentHTML('beforeend',rowHtml);
    else uvcpuBody.insertAdjacentHTML('beforeend',rowHtml);

    // ticker (only if BOTH teams ranked at kickoff)
    if(ar && br){
      const winner = a>h ? `${A} ${a}‚Äì${h}` : `${H} ${h}‚Äì${a}`;
      tickerItems.push(`<span>${wk}: #${ar} ${A} @ #${br} ${H} ‚Äî ${winner}</span>`);
    }
  });
});
tickerRow.innerHTML = tickerItems.join('') || '<span>No ranked user finals yet‚Ä¶</span>';

/* Completion Grid */
const compHead=document.getElementById('compHead');
const compBody=document.getElementById('compBody');
compHead.innerHTML = `
  <tr>
    <th class="sticky">Team</th>
    ${weekLabels.map(w=>`<th>${w}</th>`).join("")}
    <th>Total</th>
    <th>Miss Left (W6+)</th>
  </tr>`;

// set of weeks that count against the late-join allowance (>=6)
const post6Weeks = new Set(weekLabels.filter(w=>weekNum(w)>=6));

[...completions.keys()].sort().forEach(team=>{
  const weeks = completions.get(team);
  const joinedFrom = LATE_JOINERS[team] ?? 0;
  const total = weeks.size;

  // allowed misses: only for late joiners -> 1, others -> 0
  const allowed = (team in LATE_JOINERS) ? 1 : 0;
  let missesUsed = 0;
  post6Weeks.forEach(w=>{
    if(joinedBy(team, weekNum(w))){ // only count after they joined
      if(!weeks.has(w)) missesUsed++;
    }
  });
  const missLeft = Math.max(allowed - missesUsed, 0);
  const missCell = allowed ? `${missLeft}` : "‚Äî";

  const row = `
    <tr>
      <td class="sticky">${team}</td>
      ${weekLabels.map(w=>{
        const wN = weekNum(w);
        if(!joinedBy(team,wN)) return `<td><span class="dot blank"> </span></td>`;
        return `<td>${weeks.has(w)?'<span class="dot done">‚úì</span>':'<span class="dot">‚Äî</span>'}</td>`;
      }).join("")}
      <td class="total">${total}</td>
      <td>${missCell}</td>
    </tr>`;
  compBody.insertAdjacentHTML('beforeend', row);
});
</script>
</body>
</html>

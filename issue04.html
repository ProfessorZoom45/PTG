<!DOCTYPE html>
<html lang="en" id="top">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Running Late Dynasty — Week 4</title>
<meta name="description" content="D1SN hub: Power Index (Users Only), Combined Week 4 Top-25 (Media + Coaches), Week 3 Finals, Week 4 In-Progress (Users Only), Week 4 Slate + GOTW vote, Upsets, Conference Tracker." />
<meta name="color-scheme" content="dark" />
<link rel="canonical" href="https://professorzoom45.github.io/PTG/">

<!-- Social -->
<meta property="og:type" content="website">
<meta property="og:site_name" content="Perfect Timing Gaming">
<meta property="og:title" content="Running Late Dynasty — Week 4" />
<meta property="og:description" content="Power Index (Users Only), Combined Top-25 (after Week 3), Week 3 Finals, Week 4 In-Progress (UvU/UvCPU), Week 4 Slate + GOTW vote, Upsets & more." />
<meta property="og:url" content="https://professorzoom45.github.io/PTG/">
<meta property="og:image" content="https://professorzoom45.github.io/PTG/issue04cover.jpg">
<meta property="og:image:secure_url" content="https://professorzoom45.github.io/PTG/issue04cover.jpg">

<style>
:root{
  --bg:#0b0b0b;--card:#141414;--line:#232323;--text:#e6e6e6;--muted:#a6a6a6;
  --gold:#d5b15b;--silver:#c0c0c0;--bronze:#cd7f32;--accent:#f2d675;
  --up:#16c784;--down:#ff5c5c;--no:#9aa3ad;--cpu:#ff6b6b;
  --win-bg:#143a29;--win-fg:#bff8d7;--loss-bg:#3f2629;--loss-fg:#ffd0d0;
  --chip:#121212;--chip-b:#2a2a2a;
  --btn-a:#1a1a1a;--btn-b:#262626;--btn-glow:#f2d67566
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
a{color:var(--gold);text-decoration:none}
a:focus-visible,.chip:focus-visible,.cta-btn:focus-visible{outline:2px solid var(--accent);outline-offset:2px;border-radius:10px}
h1,h2{margin:0 0 .6rem}
p{margin:.4rem 0 .8rem}
.small{font-size:.92rem;color:#b0b0b0}
.muted{color:var(--muted)}
.section{max-width:1100px;margin:0 auto;padding:18px 14px;scroll-margin-top:72px}
.card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px}
.hidden{display:none!important}
footer{max-width:1100px;margin:12px auto 40px;padding:0 14px;color:#aaa;font-size:.9rem}

/* Chips */
.chips{max-width:1100px;margin:10px auto 6px;padding:0 14px;display:flex;gap:8px;flex-wrap:wrap}
.chip{display:inline-block;padding:8px 12px;border-radius:999px;background:var(--chip);border:1px solid var(--chip-b);color:#eaeaea;font-weight:600}
.chip:hover{border-color:var(--accent);color:var(--accent)}

/* Ticker */
.ticker{position:sticky;top:0;z-index:999;background:linear-gradient(90deg,#121212,#181818);border-bottom:1px solid #1f1f1f}
.ticker .wrap{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:10px;padding:10px 14px;flex-wrap:wrap}
.ticker .logo-a{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:10px;background:linear-gradient(180deg,#f7e8a5,#d6b458 60%,#a3832c);color:#111;font-weight:900;letter-spacing:.6px;border:1px solid #caae51;box-shadow:0 0 0 2px #3c3210 inset, 0 2px 10px #0008}
.ticker .track{overflow:hidden;flex:1;min-width:280px}
.ticker .row{display:inline-flex;gap:28px;align-items:center;white-space:nowrap;animation:marquee 30s linear infinite}
.ticker:hover .row{animation-play-state:paused}
.ticker .row>*{font-weight:900;letter-spacing:.3px;position:relative;padding-right:36px;margin-right:36px}
.ticker .row>*::after{content:"";position:absolute;right:8px;top:50%;transform:translateY(-50%);width:6px;height:24px;background:linear-gradient(180deg,#f7e8a5,#d6b458 60%,#a3832c);border-radius:3px}
@keyframes marquee{from{transform:translateX(0)} to{transform:translateX(-50%)}}
.cta-btn{margin-left:8px;border:1px solid #3c3c3c;padding:8px 14px;border-radius:12px;color:#fff;background:linear-gradient(180deg,var(--btn-a),var(--btn-b));box-shadow:0 0 0 2px #000 inset, 0 0 18px var(--btn-glow);font-weight:800;letter-spacing:.2px}
.cta-btn:hover{filter:brightness(1.08);box-shadow:0 0 0 2px #000 inset,0 0 22px var(--btn-glow)}

/* Splash */
.splash{min-height:42vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;color:var(--accent);position:relative}
.splash h1{font-size:clamp(2rem,4.8vw,3rem)}
.splash-hero{width:min(100%,1100px);max-width:92vw;height:auto;margin:.75rem auto 0;border-radius:16px;border:1px solid #2a2a2a;box-shadow:0 10px 40px #000a}

/* Tables */
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #2a2a2a;padding:8px 10px;text-align:left;vertical-align:top}
.sortable th{user-select:none;cursor:pointer}
.sortable th[aria-sort="ascending"],.sortable th[aria-sort="descending"]{color:var(--accent)}
.cell-win{background:var(--win-bg);color:var(--win-fg);border-radius:6px;padding:3px 8px}
.cell-loss{background:var(--loss-bg);color:var(--loss-fg);border-radius:6px;padding:3px 8px}
.delta-up{color:var(--up);font-weight:700}
.delta-down{color:var(--down);font-weight:700}
.delta-none{color:var(--no)}
.cpu{color:var(--cpu);font-weight:700}

/* Badges + medals */
.badge{display:inline-block;border:1px solid #3a3a3a;background:#111;padding:2px 8px;border-radius:999px;font-size:.8rem;margin-left:8px}
.badge-uvu{border-color:#5151a3}
.badge-upset{border-color:#774040;color:#ffd0d0}
.gold{color:var(--gold);font-weight:900}
.silver{color:var(--silver);font-weight:900}
.bronze{color:var(--bronze);font-weight:900}

@media (max-width:560px){ .ticker .row>*{padding-right:20px;margin-right:20px} }
</style>
</head>
<body>

<!-- Ticker -->
<div class="ticker" role="region" aria-label="D1SN Headlines">
  <div class="wrap">
    <a href="https://professorzoom45.github.io/PTG/" class="logo-a" title="Home (Index)">D1SN</a>
    <div class="track"><div class="row" id="tickerRow"></div></div>
    <a class="cta-btn" href="teams.html" title="Schools & Coaches (Team Pages)">Team Pages</a>
    <a class="cta-btn" href="coaches.html" title="Coaches Directory">Coaches</a>
    <a class="cta-btn" href="mailto:changethewrldplz@gmail.com?subject=DM%20D1SN&body=Hey%20D1SN%2C%20" title="Email D1SN Directly">DM D1SN</a>
  </div>
</div>

<!-- Chips -->
<div class="chips">
  <a class="chip" href="#headline">Headline</a>
  <a class="chip" href="#gotwrecap">W3 GOTW Recap</a>
  <a class="chip" href="#power">Power Index</a>
  <a class="chip" href="#top25">Top-25 — Combined</a>
  <a class="chip" href="#week3">Week 3 — Finals</a>
  <a class="chip" href="#week4ip">Week 4 — In Progress</a>
  <a class="chip" href="#week4">Week 4 — Slate</a>
  <a class="chip" href="#gotw">Game of the Week</a>
  <a class="chip" href="#upsets">Upset Alert</a>
  <a class="chip" href="#conf">Conference Supremacy Tracker</a>
  <a class="chip" href="previous-schedules.html" title="Opens the archive (Weeks 0–2)">Previous Schedules</a>
  <a class="chip" href="teams.html" title="Schools & Coaches Directory (Links To All 32 Team Pages)">Schools & Coaches</a>
  <a class="chip" href="coaches.html" title="Coaches Directory (Owners)">Coaches (Owners)</a>
  <a class="chip" href="#mail">Mailbag</a>
</div>

<!-- Splash -->
<section class="splash">
  <h1>Running Late Dynasty — Week 4</h1>
  <img id="splashHero" class="splash-hero" alt="Week 4 Cover"
       src="https://professorzoom45.github.io/PTG/issue04cover.jpg" />
</section>

<!-- Headline -->
<section id="headline" class="section">
  <h2>W4 GOTW Locked: <strong>#1 Alabama</strong> at <strong>#5 LSU</strong></h2>
  <div class="card">
    <p><strong>Hatred Runs Deep.</strong> The SEC belt moves center stage as <strong>Alabama</strong> rolls into Death Valley for a primetime showdown with <strong>LSU</strong>. It’s power vs. power—exactly what Week 4 was made for.</p>
    <p class="small muted">Power Index ranks only user teams; the Combined Top-25 below merges Media and Coaches polls from the end of Week 3. User teams are bolded everywhere.</p>
  </div>
</section>

<!-- Week 3 GOTW Recap -->
<section id="gotwrecap" class="section">
  <h2>Week 3 GOTW Recap: <strong>#9 LSU</strong> 28, <strong>#13 BYU</strong> 21</h2>
  <div class="card">
    <p><strong>How it swung:</strong> In Provo, LSU survived a third-quarter surge and slammed the door with a 14–0 fourth to steal a statement road win. The Tigers leaned on explosive efficiency—just 25 plays for 262 yards (10.5 YPP!)—and two ground scores to outlast a methodical BYU side.</p>
    <div style="display:grid;grid-template-columns:1fr;gap:10px;align-items:start">
      <img src="byu.png" alt="LSU 28 at BYU 21 — Team Stats" style="width:100%;max-width:1000px;border-radius:12px;border:1px solid #2a2a2a">
      <img src="lsu.png" alt="LSU Tigers Team Stats" style="width:100%;max-width:1000px;border-radius:12px;border:1px solid #2a2a2a">
      <div class="small muted">
        <p><strong>Quick numbers:</strong></p>
        <ul style="margin:0 0 .4rem 1.2rem">
          <li>Quarters: LSU 6–8–0–14 = 28; BYU 7–0–14–0 = 21</li>
          <li>First Downs: LSU 8 • BYU 17</li>
          <li>Total Offense / Plays / YPP: LSU 262 / 25 / <strong>10.5</strong> • BYU 239 / 44 / 5.4</li>
          <li>Rush: LSU 18–152–2 (8.4 YPC) • BYU 28–128–1 (4.6 YPC)</li>
          <li>Pass: LSU 5/7–110–2 (15.7 YPA) • BYU 11/16–111–1 (6.9 YPA)</li>
          <li>3rd Down: LSU 0/3 (0%) • BYU 6/9 (66%)</li>
        </ul>
        <p><em>Bottom line:</em> BYU won the down-to-down battle, but LSU’s explosives and fourth-quarter clutch gene carried the belt into Week 4—in time for a date with #1 Alabama.</p>
      </div>
    </div>
  </div>
</section>

<!-- Power Index -->
<section id="power" class="section">
  <h2>Power Index</h2>
  <div class="card">
    <p class="small">User-only list (32 teams). Elo base 1500 with margin factor; CPU teams are excluded. Medals: <span class="gold">#1 Gold</span>, <span class="silver">#2 Silver</span>, <span class="bronze">#3 Bronze</span>.</p>
    <table class="table sortable" id="powerTable">
      <thead>
        <tr><th data-type="num">#</th><th data-type="str">Team</th><th data-type="num">Rating</th><th data-type="rec">Record</th></tr>
      </thead>
      <tbody id="powerBody"></tbody>
    </table>
  </div>
</section>

<!-- Top-25 (Combined) -->
<section id="top25" class="section">
  <h2>Top-25 — Combined (Media + Coaches)</h2>
  <div class="card">
    <p class="small">We combine Media and Coaches polls by averaging ranks (NR = 26). Table shows each source’s rank & points.</p>
    <table class="table sortable" id="pollComboTable">
      <thead>
        <tr>
          <th data-type="num">#</th>
          <th data-type="str">Team</th>
          <th data-type="str">Media</th>
          <th data-type="str">Coaches</th>
          <th data-type="rec">Record</th>
        </tr>
      </thead>
      <tbody id="pollComboBody"></tbody>
    </table>
    <div id="comboNotes" class="small" style="margin-top:10px"></div>
  </div>
</section>

<!-- Week 3 -->
<section id="week3" class="section">
  <h2>Week 3 — Final Scores</h2>
  <div class="card">
    <table class="table sortable" id="wk3Table">
      <thead><tr><th data-type="str">Away</th><th data-type="num">A</th><th data-type="str">Home</th><th data-type="num">H</th><th data-type="str">Type</th></tr></thead>
      <tbody id="wk3Body"></tbody>
    </table>
  </div>
</section>

<!-- Week 4 — In Progress (Users Only: UvU & UvCPU) -->
<section id="week4ip" class="section">
  <h2>Week 4 — In Progress (Users Only)</h2>
  <div class="card">
    <table class="table sortable" id="wk4ipTable">
      <thead><tr><th data-type="str">Away</th><th data-type="num">A</th><th data-type="str">Home</th><th data-type="num">H</th><th data-type="str">Type</th></tr></thead>
      <tbody id="wk4ipBody"></tbody>
    </table>
  </div>
</section>

<!-- Game of the Week -->
<section id="gotw" class="section">
  <h2>Game of the Week <span class="badge badge-uvu">UvU</span></h2>
  <div class="card" id="gotwCard"></div>
</section>

<!-- Upset Alert (Week 3 Only) -->
<section id="upsets" class="section">
  <h2>Upset Alert <span class="badge badge-upset">Week 3 Only</span></h2>
  <div class="card">
    <ul id="upsetList" style="margin:0;padding-left:18px"></ul>
    <p class="small muted" id="upsetNote"></p>
  </div>
</section>

<!-- Conference Supremacy Tracker -->
<section id="conf" class="section">
  <h2>Conference Supremacy Tracker</h2>
  <div class="card">
    <p class="small">Counts <strong>only</strong> <em>User vs User</em> games from Weeks 0–2 (and beyond as logged). Win% = Wins ÷ (Wins + Losses). Intra-conference UvU adds one win and one loss to the same conference.</p>
    <div id="confBlurb" class="small" style="margin-bottom:10px"></div>
    <div id="confTableWrap"></div>
  </div>
</section>

<!-- Week 4 — Slate (Image + GOTW Vote) -->
<section id="week4" class="section">
  <h2>Week 4 — User Games Slate</h2>
  <div class="card">
    <p class="small"><strong>Vote For Game Of The Week:</strong> <a href="https://discord.com/channels/1382826467683205180/1407980310158905448" target="_blank" rel="noopener">Discord Poll Link</a></p>
    <a href="https://professorzoom45.github.io/PTG/week4slate.jpg" target="_blank" rel="noopener">
      <img id="wk4Img" class="splash-hero" loading="lazy"
           src="https://professorzoom45.github.io/PTG/week4slate.jpg"
           alt="Week 4 User Games Slate">
    </a>
    <p id="wk4Fallback" class="small muted hidden">Trying alternate image name…</p>
  </div>
</section>

<!-- Mailbag -->
<section id="mail" class="section">
  <h2>Mailbag & Submissions</h2>
  <div class="card">
    <p>Email <a href="mailto:changethewrldplz@gmail.com">changethewrldplz@gmail.com</a>, post in <a href="https://discord.com/channels/1382826467683205180/1382826468622467133" target="_blank" rel="noopener">Discord #general</a>, or click <a href="mailto:changethewrldplz@gmail.com">DM D1SN</a>.</p>
    <p class="muted">Submit top stat lines, highlights, or chaos moments; we’ll post them after verification.</p>
  </div>
</section>

<footer>© D1SN — Running Late Dynasty. Tip: press <kbd>Enter</kbd> on a table header to sort.</footer>

<script>
/* ===== User Teams / Conferences ===== */
const USER_TEAMS=["LSU","Clemson","Arkansas","Michigan","Texas","Ohio State","Miami","Delaware","Georgia","Arizona State","Florida","Washington","Alabama","BYU","Oklahoma","Florida State","Notre Dame","South Carolina","Illinois","USC","Texas Tech","Baylor","Colorado","Texas A&M","Penn State","Tennessee","North Carolina","Utah","Auburn","Minnesota","SMU","UCLA"];

const TEAM_CONF={
  "Georgia":"SEC","Alabama":"SEC","LSU":"SEC","Texas":"SEC","Oklahoma":"SEC","Florida":"SEC","Tennessee":"SEC","Texas A&M":"SEC","South Carolina":"SEC","Arkansas":"SEC","Auburn":"SEC","Baylor":"SEC",
  "Ohio State":"Big Ten","Michigan":"Big Ten","Penn State":"Big Ten","USC":"Big Ten","UCLA":"Big Ten","Washington":"Big Ten","Minnesota":"Big Ten","Illinois":"Big Ten",
  "Clemson":"ACC","Florida State":"ACC","Miami":"ACC","North Carolina":"ACC","SMU":"ACC","Notre Dame":"ACC",
  "Colorado":"Big 12","Texas Tech":"Big 12","Utah":"Big 12","Arizona State":"Big 12","BYU":"Big 12","Delaware":"Big 12"
};
const isUser = t => USER_TEAMS.includes(t);

/* ===== Preseason Poll (for upset calc) ===== */
const POLL_PRE=[[1,"Georgia"],[2,"Ohio State"],[3,"Notre Dame"],[4,"Texas"],[5,"Alabama"],[6,"North Carolina"],[7,"Miami"],[8,"Penn State"],[9,"LSU"],[10,"Clemson"],[11,"Minnesota"],[12,"USC"],[13,"Texas Tech"],[14,"Florida State"],[15,"Oklahoma"],[16,"Florida"],[17,"Washington"],[18,"Baylor"],[19,"Tennessee"],[20,"Texas A&M"],[21,"Colorado"],[22,"Arkansas"],[23,"BYU"],[24,"Utah"],[25,"Illinois"]];

/* ===== Week 0–2 Finals ===== */
const WEEK0_RESULTS=[
  {away:"Florida",a:27,home:"Washington",h:42},
  {away:"USC",a:7,home:"Texas",h:40},
  {away:"Ohio",a:3,home:"Ohio State",h:28},
  {away:"Illinois",a:0,home:"Texas Tech",h:28},
  {away:"Temple",a:20,home:"Penn State",h:57},
  {away:"Iowa",a:7,home:"Alabama",h:42},
  {away:"Indiana",a:24,home:"LSU",h:26},
  {away:"UCLA",a:10,home:"California",h:14},
  {away:"Michigan",a:20,home:"Houston",h:0},
  {away:"Utah",a:56,home:"Utah State",h:31},
  {away:"SMU",a:14,home:"Baylor",h:37},
  {away:"BYU",a:21,home:"Clemson",h:17},
  {away:"Miami",a:63,home:"Central Michigan",h:3}
];
const WEEK1_RESULTS=[
  {away:"Clemson",a:14,home:"LSU",h:31},
  {away:"Texas A&M",a:38,home:"Missouri State",h:3},
  {away:"Texas",a:48,home:"Texas State",h:3},
  {away:"California",a:44,home:"Tennessee",h:47},
  {away:"Arizona State",a:7,home:"South Carolina",h:20},
  {away:"Marshall",a:3,home:"Penn State",h:70},
  {away:"Michigan",a:35,home:"NC State",h:20},
  {away:"Georgia",a:26,home:"Miami",h:38},
  {away:"Florida State",a:38,home:"Ole Miss",h:24},
  {away:"Alabama",a:21,home:"Ohio State",h:14}
];
const WEEK2_RESULTS=[
  {away:"Maryland",a:13,home:"Washington",h:19},
  {away:"UCLA",a:31,home:"Kennesaw State",h:7},
  {away:"Texas Tech",a:43,home:"Oregon State",h:17},
  {away:"Wisconsin",a:9,home:"South Carolina",h:77},
  {away:"Oklahoma",a:10,home:"Michigan",h:24},
  {away:"NC State",a:7,home:"Miami",h:58},
  {away:"USC",a:13,home:"LSU",h:42},
  {away:"BYU",a:66,home:"Utah State",h:3},
  {away:"Auburn",a:17,home:"Army",h:7},
  {away:"Arizona State",a:31,home:"Texas A&M",h:13},
  {away:"Florida State",a:24,home:"Texas",h:21},
  {away:"Tennessee",a:28,home:"Indiana",h:35},
  {away:"Alabama",a:42,home:"California",h:17}
];

/* ===== Week 3 Finals (from screenshots) ===== */
const WEEK3_RESULTS=[
  {away:"Washington",a:56,home:"Washington State",h:20},
  {away:"Alabama",a:21,home:"Utah",h:31},
  {away:"Georgia State",a:21,home:"Georgia",h:56},
  {away:"South Carolina",a:41,home:"Missouri",h:10},
  {away:"Buffalo",a:7,home:"Penn State",h:63},
  {away:"Baylor",a:35,home:"Ohio State",h:41},
  {away:"Oregon",a:23,home:"Oregon State",h:10},
  {away:"New Mexico",a:21,home:"Oklahoma",h:28},
  {away:"Miami",a:63,home:"Syracuse",h:17},
  {away:"LSU",a:28,home:"BYU",h:21},
  {away:"Delaware",a:13,home:"Georgia Tech",h:10},
  {away:"Boston College",a:13,home:"Clemson",h:24},
  {away:"Hawai'i",a:14,home:"Arizona State",h:35}
];

/* ========= Week 4 schedule ========= */
const WEEK4_SCHEDULE = [
  "#25 Illinois @ #5 North Carolina",
  "#13 Colorado @ #17 Utah",
  "#1 Alabama @ #5 LSU",
  "Florida @ #23 Baylor",
  "#14 Texas A&M @ Tennessee"
];

/* ===== Media & Coaches Polls (Week 4 / after Week 3) ===== */
const MEDIA_POLL=[
  [1,"Miami",1598],[2,"Notre Dame",1522],[3,"South Carolina",1449],[4,"Penn State",1290],[5,"LSU",1215],
  [6,"Ohio State",1193],[7,"Minnesota",1092],[8,"Georgia",984],[9,"Washington",910],[10,"Alabama",877],
  [11,"Texas",812],[12,"Texas Tech",812],[13,"Colorado",732],[14,"North Carolina",732],[15,"Utah",706],
  [16,"Michigan",656],[17,"BYU",579],[18,"SMU",561],[19,"Oregon",508],[20,"Delaware",412],
  [21,"Florida State",354],[22,"Texas A&M",334],[23,"Florida",301],[24,"Arkansas",252],[25,"Arizona State",212]
];
const COACHES_POLL=[
  [1,"Miami",1499],[2,"South Carolina",1436],[3,"Notre Dame",1374],[4,"Ohio State",1193],[5,"Minnesota",1163],
  [6,"LSU",1114],[7,"Penn State",1105],[8,"Georgia",953],[9,"Texas",899],[10,"Alabama",851],
  [11,"Washington",849],[12,"Colorado",785],[13,"Texas Tech",744],[14,"Michigan",695],[15,"North Carolina",670],
  [16,"SMU",599],[17,"Utah",552],[18,"BYU",520],[19,"Oregon",512],[20,"Texas A&M",475],
  [21,"Delaware",409],[22,"Arkansas",334],[23,"Florida State",334],[24,"Florida",234],[25,"Florida Atlantic",214]
];

/* ===== Helpers ===== */
const allResults = ()=>WEEK0_RESULTS.concat(WEEK1_RESULTS,WEEK2_RESULTS,WEEK3_RESULTS);
const preRank = new Map(POLL_PRE.map(([rk,t])=>[t,rk]));
const recordMap = (()=>{ const m=new Map(); const add=(t,w)=>{const r=m.get(t)||{w:0,l:0}; r[w?'w':'l']++; m.set(t,r);};
  allResults().forEach(g=>{ const w=g.a>g.h?g.away:g.home; const l=g.a>g.h?g.home:g.away; add(w,true); add(l,false); }); return m; })();

/* ===== Sorting helper ===== */
function makeSortable(table){
  if(!table) return;
  const ths=[...table.querySelectorAll('thead th')];
  ths.forEach((th,i)=>{
    th.setAttribute('aria-sort','none'); th.tabIndex=0;
    th.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' ') { e.preventDefault(); th.click(); }});
    th.addEventListener('click',()=>{
      const type=th.dataset.type||'str',tbody=table.tBodies[0],rows=[...tbody.rows];
      const dir=th.getAttribute('aria-sort')==='ascending'?'descending':'ascending';
      ths.forEach(x=>x.setAttribute('aria-sort','none')); th.setAttribute('aria-sort',dir);
      const parse=td=>{
        const v=td.textContent.trim();
        if(type==='num') return +v.replace(/[^0-9.-]/g,'')||0;
        if(type==='rec'){const m=v.match(/(\d+)\s*-\s*(\d+)/); return m?(+m[1]*100-+m[2]):0;}
        return v.toLowerCase();
      };
      rows.sort((a,b)=>{const A=parse(a.cells[i]),B=parse(b.cells[i]); return (A<B? -1: A>B? 1: 0)*(dir==='ascending'?1:-1);});
      rows.forEach(r=>tbody.appendChild(r));
    });
  });
}

/* ===== Power Index (Elo, Users Only) ===== */
function computeElo(){
  const K=24, R=new Map(), getR=t=>R.has(t)?R.get(t):1500, setR=(t,v)=>R.set(t,v);
  USER_TEAMS.forEach(t=>setR(t,1500));
  allResults().forEach(g=>{ setR(g.away,getR(g.away)); setR(g.home,getR(g.home)); });
  allResults().forEach(g=>{
    const Ra=getR(g.away), Rb=getR(g.home), Sa=g.a>g.h?1:0, Sb=1-Sa;
    const Ea=1/(1+Math.pow(10,(Rb-Ra)/400)), Eb=1-Ea;
    const margin=Math.max(1, Math.log1p(Math.abs(g.a-g.h))/0.7);
    setR(g.away, Ra + K*margin*(Sa-Ea)); setR(g.home, Rb + K*margin*(Sb-Eb));
  });
  return USER_TEAMS.map(t=>{
    const r=Math.round(getR(t)); const rr=recordMap.get(t)||{w:0,l:0};
    return {t, r, w:rr.w||0, l:rr.l||0};
  }).sort((a,b)=> b.r-a.r);
}
function renderPower(){
  const rows=computeElo();
  const body=document.getElementById('powerBody');
  body.innerHTML=rows.map((x,i)=>{
    const medalCls = i===0?'gold':i===1?'silver':i===2?'bronze':'';
    const teamCell = medalCls ? `<span class="${medalCls}"><strong>${x.t}</strong></span>` : `<strong>${x.t}</strong>`;
    return `<tr><td>${i+1}</td><td>${teamCell}</td><td>${x.r}</td><td>${x.w}-${x.l}</td></tr>`;
  }).join('');
  makeSortable(document.getElementById('powerTable'));
}

/* ===== Combined Poll Render ===== */
function renderCombinedPoll(){
  const rec=(t)=>{const r=recordMap.get(t)||{w:0,l:0}; return `${r.w||0}-${r.l||0}`;};
  const mRank=new Map(MEDIA_POLL.map(([rk,t,pts])=>[t,{rk,pts}]));
  const cRank=new Map(COACHES_POLL.map(([rk,t,pts])=>[t,{rk,pts}]));
  const teams=new Set([...mRank.keys(),...cRank.keys()]);

  const combined=[...teams].map(t=>{
    const mr=mRank.get(t)?.rk ?? 26, cr=cRank.get(t)?.rk ?? 26;
    const mp=mRank.get(t)?.pts ?? 0, cp=cRank.get(t)?.pts ?? 0;
    const avg=(mr+cr)/2;
    return {t, mr, mp, cr, cp, avg, rec:rec(t)};
  }).sort((a,b)=> a.avg-b.avg || (b.mp+b.cp)-(a.mp+a.cp));

  const body=document.getElementById('pollComboBody');
  body.innerHTML=combined.map((x,i)=>{
    const isNo1=i===0, name=isNo1?`<span class="gold">${x.t}</span>`:x.t;
    const mTxt = (x.mr<=25)?`#${x.mr} (${x.mp})`:'NR';
    const cTxt = (x.cr<=25)?`#${x.cr} (${x.cp})`:'NR';
    return `<tr><td>${i+1}</td><td>${name}</td><td>${mTxt}</td><td>${cTxt}</td><td>${x.rec}</td></tr>`;
  }).join('');
  document.getElementById('comboNotes').innerHTML =
    `#1 overall is highlighted in <span class="gold">gold</span>. NR = not ranked in that poll.`;
  makeSortable(document.getElementById('pollComboTable'));
}

/* ===== Generic Week Table Renderer (bolds user teams) ===== */
function renderWeek(tblId,bodyId,games){
  const body=document.getElementById(bodyId);
  if(!games.length){
    body.innerHTML = `<tr><td colspan="5" class="small muted">No games entered yet.</td></tr>`;
    makeSortable(document.getElementById(tblId));
    return;
  }
  body.innerHTML=games.map(g=>{
    const awayWin=g.a>g.h, type=(isUser(g.away)&&isUser(g.home))?'User vs User':(isUser(g.away)||isUser(g.home))?'User vs CPU':'CPU vs CPU';
    const A=isUser(g.away)?`<strong>${g.away}</strong>`:g.away;
    const H=isUser(g.home)?`<strong>${g.home}</strong>`:g.home;
    return `<tr>
      <td class="${awayWin?'cell-win':'cell-loss'}">${A}</td>
      <td class="${awayWin?'cell-win':'cell-loss'}">${g.a}</td>
      <td class="${!awayWin?'cell-win':'cell-loss'}">${H}</td>
      <td class="${!awayWin?'cell-win':'cell-loss'}">${g.h}</td>
      <td>${type}</td>
    </tr>`;
  }).join('');
  makeSortable(document.getElementById(tblId));
}

/* ===== Week 4 In-Progress ===== */
function parseMatchup(str){
  const clean=s=>s.replace(/^\s*#\d+\s*/,'').trim();
  let a='',b='', ar=null, br=null;
  const rxRank=/#(\d+)/g; const ranks=[...str.matchAll(rxRank)].map(m=>+m[1]);
  if(str.includes(' @ ')) [a,b]=str.split(' @ ').map(clean);
  else if(str.includes(' at ')) [a,b]=str.split(' at ').map(clean);
  else if(str.includes(' vs ')) [a,b]=str.split(' vs ').map(clean);
  else { a=str.trim(); b=''; }
  if(ranks.length){ ar=ranks[0]??null; br=ranks[1]??null; }
  return {a,b,ar,br,raw:str};
}
function matchupType(a,b){
  const aU=isUser(a), bU=isUser(b);
  if(aU&&bU) return 'User vs User';
  if(aU^bU)  return 'User vs CPU';
  return 'CPU vs CPU';
}
function renderWeek4InProgress(){
  const body=document.getElementById('wk4ipBody');
  const rows=WEEK4_SCHEDULE.map(x=>parseMatchup(x));
  const filtered=rows.filter(({a,b})=>matchupType(a,b)!=='CPU vs CPU');
  body.innerHTML = filtered.map(({a,b})=>{
    const A=isUser(a)?`<strong>${a}</strong>`:a;
    const H=isUser(b)?`<strong>${b}</strong>`:b;
    return `<tr><td>${A}</td><td>—</td><td>${H}</td><td>—</td><td>${matchupType(a,b)}</td></tr>`;
  }).join('') || `<tr><td colspan="5" class="small muted">No user-involved games found in the Week 4 slate.</td></tr>`;
  makeSortable(document.getElementById('wk4ipTable'));
}

/* ===== GOTW (expects Week 4 schedule) ===== */
function gotwScore(m){
  const {a,b,ar,br}=parseMatchup(m);
  const uvu=isUser(a)&&isUser(b);
  const ranked=(ar&&ar<=25)&&(br&&br<=25);
  const sum=(ar||50)+(br||50);
  return (uvu?1000:0)+(ranked?500:0)+(50-sum);
}
function renderGOTW(){
  const candidates=WEEK4_SCHEDULE.filter(Boolean);
  const filtered=candidates.filter(s=>matchupType(...Object.values(parseMatchup(s)).slice(0,2))!=='CPU vs CPU');
  if(!filtered.length){
    document.getElementById('gotwCard').innerHTML=`<p class="small muted">Add Week 4 schedule above to auto-select a GOTW (prefers ranked UvU).</p>`;
    return;
  }
  const best=filtered.slice().sort((x,y)=>gotwScore(y)-gotwScore(x))[0];
  const {a,b,ar,br}=parseMatchup(best);
  const ra=recordMap.get(a)||{w:0,l:0}, rb=recordMap.get(b)||{w:0,l:0};
  const notes=[];
  if(isUser(a)&&isUser(b)) notes.push('User vs User');
  if(ar&&br){ const top=Math.min(ar,br); notes.push(top<=5?'Top-5 Matchup':top<=10?'Top-10 Matchup':'Top-25 Matchup'); }
  document.getElementById('gotwCard').innerHTML =
    `<p><strong>${ar?`#${ar} `:''}${a}</strong> @ <strong>${br?`#${br} `:''}${b}</strong> <span class="badge badge-uvu">${notes.join(' • ')||'—'}</span></p>
     <p class="small">Records So Far: ${isUser(a)?`<strong>${a}</strong>`:a} ${ra.w||0}-${ra.l||0} • ${isUser(b)?`<strong>${b}</strong>`:b} ${rb.w||0}-${rb.l||0}</p>
     <p class="small"><strong>Vote Here:</strong> <a href="https://discord.com/channels/1382826467683205180/1407980310158905448" target="_blank" rel="noopener">Discord GOTW Poll</a></p>`;
}

/* ===== Upset Alert (Week 3 Only) ===== */
function findWeek3Upsets(){
  const games=WEEK3_RESULTS, upsets=[];
  const preMap=new Map(POLL_PRE.map(([rk,t])=>[t,rk]));
  games.forEach(g=>{
    const winner=g.a>g.h?g.away:g.home, loser=g.a>g.h?g.home:g.away;
    const wr=preMap.get(winner)??99, lr=preMap.get(loser)??99;
    const wScore=Math.max(g.a,g.h), lScore=Math.min(g.a,g.h);
    if(lr<wr || (wr===99&&lr<=25)){
      upsets.push({winner,loser,wr:(wr===99?'NR':wr),lr,wScore,lScore});
    }
  });
  return upsets;
}
function renderUpsets(){
  const list=document.getElementById('upsetList');
  const arr=findWeek3Upsets();
  if(!arr.length){
    list.innerHTML='<li class="small muted">No Week 3 upsets listed yet.</li>';
    document.getElementById('upsetNote').textContent='This section updates as more Week 3 finals are entered.';
    return;
  }
  list.innerHTML=arr.map(u=>{
    const W=isUser(u.winner)?`<strong>${u.winner}</strong>`:u.winner;
    const L=isUser(u.loser)?`<strong>${u.loser}</strong>`:u.loser;
    return `<li>${W} (${u.wr}) def. ${L} (#${u.lr}) ${u.wScore}–${u.lScore}</li>`;
  }).join('');
  document.getElementById('upsetNote').textContent='Using preseason ranks as baseline.';
}

/* ===== Conference Supremacy Tracker (UvU Only) ===== */
function getUserVsUserGames(){ return allResults().filter(g=>isUser(g.away)&&isUser(g.home)); }
function computeUvUConferenceStats(){
  const stats={};
  USER_TEAMS.forEach(t=>{const c=TEAM_CONF[t]||'Ind'; if(!stats[c]) stats[c]={w:0,l:0,gp:0,teams:{}}; stats[c].teams[t]={w:0,l:0};});
  getUserVsUserGames().forEach(g=>{
    const winner=g.a>g.h?g.away:g.home, loser=g.a>g.h?g.home:g.away;
    const wConf=TEAM_CONF[winner]||'Ind', lConf=TEAM_CONF[loser]||'Ind';
    stats[wConf].w++; stats[wConf].gp++; stats[lConf].l++; stats[lConf].gp++;
    stats[wConf].teams[winner].w++; stats[lConf].teams[loser].l++;
  });
  return Object.entries(stats).map(([conf,d])=>{
    const pct=d.gp?d.w/(d.w+d.l):0;
    const teams=Object.entries(d.teams).sort((a,b)=>{
      const [ta,ra]=a,[tb,rb]=b;
      if(ra.w!==rb.w) return rb.w-ra.w;
      if(ra.l!==rb.l) return ra.l-rb.l;
      const pa=(mRank.get(ta)?.rk ?? 99)+(cRank.get(ta)?.rk ?? 99); // later defined maps
      const pb=(mRank.get(tb)?.rk ?? 99)+(cRank.get(tb)?.rk ?? 99);
      return pa-pb;
    });
    const leaderTeam=teams.find(([,r])=>r.w>0||r.l>0)?.[0]||teams[0][0];
    const lr=d.teams[leaderTeam];
    return {conf,w:d.w,l:d.l,gp:d.gp,pct,leader:`${leaderTeam} (${lr.w}-${lr.l})`};
  }).sort((a,b)=> b.pct-a.pct || b.w-a.w);
}
function renderConferenceTracker(){
  // Build rank maps so computeUvUConferenceStats tiebreaker can read them
  window.mRank=new Map(MEDIA_POLL.map(([rk,t])=>[t,{rk}]));
  window.cRank=new Map(COACHES_POLL.map(([rk,t])=>[t,{rk}]));

  const rows=computeUvUConferenceStats();
  const wrap=document.getElementById('confTableWrap');
  const tbl=document.createElement('table');
  tbl.className='table sortable';
  tbl.innerHTML=`<thead>
    <tr><th data-type="num">Place</th><th data-type="str">Conference</th><th data-type="num">W</th><th data-type="num">L</th><th data-type="num">Win%</th><th data-type="str">Leader</th></tr>
  </thead><tbody></tbody>`;
  const tb=tbl.tBodies[0];
  rows.forEach((r,i)=>{
    const leaderHtml=r.leader.replace(/^[^ ]+/, t => (isUser(t)? `<strong>${t}</strong>` : t));
    tb.insertAdjacentHTML('beforeend',`<tr>
      <td>${i+1}</td><td>${r.conf}</td><td>${r.w}</td><td>${r.l}</td><td>${(r.pct*100).toFixed(1)}</td><td>${leaderHtml}</td>
    </tr>`);
  });
  wrap.innerHTML=''; wrap.appendChild(tbl); makeSortable(tbl);

  if(rows[0]){
    const top=rows[0], confName=top.conf;
    const uvus=getUserVsUserGames().filter(g=> (TEAM_CONF[g.away]===confName || TEAM_CONF[g.home]===confName));
    const wins=uvus.filter(g=> TEAM_CONF[g.a>g.h?g.away:g.home]===confName)
      .map(g=>{const W=g.a>g.h?g.away:g.home, L=g.a>g.h?g.home:g.away, w=Math.max(g.a,g.h), l=Math.min(g.a,g.h);
        return `${isUser(W)?`<strong>${W}</strong>`:W} ${w}–${l} over ${isUser(L)?`<strong>${L}</strong>`:L}`;});
    document.getElementById('confBlurb').innerHTML =
      `<strong>${confName</strong>} leads at <strong>${top.w}-${top.l}</strong> (${(top.pct*100).toFixed(1)}%). Recent ${confName} UvU results: <em>${wins.join(' • ')||'—'}</em>.`;
  }
}

/* ===== Ticker (Week 4 slate + Week 3 highlights) ===== */
function renderTicker(){
  const row=document.getElementById('tickerRow');
  const highlights=[
    "W3 GOTW: LSU 28–21 BYU",
    "Utah 31–21 Alabama",
    "Washington 56–20 Washington State",
    "Ohio State 41–35 Baylor",
    "Penn State 63–7 Buffalo",
    "South Carolina 41–10 Missouri",
    "Miami 63–17 Syracuse",
    "Delaware 13–10 Georgia Tech",
    "Clemson 24–13 Boston College",
    "Arizona State 35–14 Hawai‘i",
    "W4 GOTW: #1 Alabama @ #5 LSU"
  ];
  row.innerHTML=highlights.map(txt=>`<span>${txt}</span>`).join('');
}

/* ===== Bold All User Teams (Global) ===== */
function boldUserTeamsEverywhere(){
  const SKIP=new Set(['SCRIPT','STYLE','CODE','PRE','TEXTAREA']);
  const teams=USER_TEAMS.slice().sort((a,b)=>b.length-a.length);
  const patterns=teams.map(t=>({t,re:new RegExp(`(^|[^A-Za-z])(${t.replace(/[-/\\^$*+?.()|[\\]{}]/g,'\\\\$&')})(?=$|[^A-Za-z])`,'g')}));
  const walker=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{
    acceptNode(node){
      const p=node.parentElement;
      if(!p||SKIP.has(p.tagName)||p.closest('strong')) return NodeFilter.FILTER_REJECT;
      if(!node.nodeValue||!node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
      return NodeFilter.FILTER_ACCEPT;
    }
  });
  const nodes=[]; while(walker.nextNode()) nodes.push(walker.currentNode);
  nodes.forEach(tn=>{
    let s=tn.nodeValue, changed=false;
    patterns.forEach(({re})=>{ s=s.replace(re,(_,pre,match)=>{changed=true;return `${pre}<strong>${match}</strong>`;}); });
    if(changed){ const span=document.createElement('span'); span.innerHTML=s; tn.parentNode.replaceChild(span,tn); }
  });
}

/* ===== Image Fallbacks ===== */
function setupHeroFallback(){
  const hero=document.getElementById('splashHero');
  if(!hero) return;
  hero.addEventListener('error',()=>{
    if(!hero.getAttribute('data-tried-alt')){
      hero.setAttribute('data-tried-alt','1');
      hero.src=hero.src.endsWith('.jpg')?hero.src.replace('.jpg','.png'):hero.src.replace('.png','.jpg');
    }
  });
}
function setupWeek4SlateFallback(){
  const img=document.getElementById('wk4Img');
  const msg=document.getElementById('wk4Fallback');
  if(!img) return;
  img.addEventListener('error',()=>{
    const tried=img.getAttribute('data-tried-alt')||'';
    let next=null;
    if(tried===''){ next=img.src.replace(/\.jpg$/i,'.jpeg'); img.setAttribute('data-tried-alt','jpeg'); }
    else if(tried==='jpeg'){ next=img.src.replace(/\.jpeg$/i,'.png'); img.setAttribute('data-tried-alt','png'); }
    else if(tried==='png'){ next=img.src.toUpperCase(); img.setAttribute('data-tried-alt','upper'); }
    else { msg?.classList.remove('hidden'); msg.textContent='Couldn’t load Week 4 slate image.'; return; }
    msg?.classList.remove('hidden'); msg.textContent='Trying alternate image name…';
    img.src=next;
  });
}

/* ===== Boot ===== */
function boot(){
  renderTicker();
  renderPower();
  renderCombinedPoll();
  renderWeek('wk3Table','wk3Body',WEEK3_RESULTS);
  renderWeek4InProgress();
  renderGOTW();
  renderUpsets();
  renderConferenceTracker();
  setupHeroFallback();
  setupWeek4SlateFallback();
  boldUserTeamsEverywhere();
}
document.addEventListener('DOMContentLoaded', boot);
</script>
</body>
</html>
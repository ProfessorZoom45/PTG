<!DOCTYPE html>
<html lang="en" id="top">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Running Late Dynasty — Week 3</title>
<meta name="description" content="D1SN hub: Power Index (Users Only), Week 3 Top-25 (Coaches, after Week 2), Week 2 Finals, Week 3 In-Progress (Users Only), Week 4 Slate + GOTW vote, Upsets, Conference Tracker." />
<meta name="color-scheme" content="dark" />
<link rel="canonical" href="https://professorzoom45.github.io/PTG/">

<!-- Social -->
<meta property="og:type" content="website">
<meta property="og:site_name" content="Perfect Timing Gaming">
<meta property="og:title" content="Running Late Dynasty — Week 3" />
<meta property="og:description" content="Power Index (Users Only), Week 3 Top-25 (after Week 2), Week 2 Finals, Week 3 In-Progress (UvU/UvCPU), Week 4 Slate + GOTW vote, Upsets & more." />
<meta property="og:url" content="https://professorzoom45.github.io/PTG/">
<meta property="og:image" content="https://professorzoom45.github.io/PTG/week3cover.png">
<meta property="og:image:secure_url" content="https://professorzoom45.github.io/PTG/week3cover.png">

<style>
:root{
  --bg:#0b0b0b;--card:#141414;--line:#232323;--text:#e6e6e6;--muted:#a6a6a6;
  --gold:#d5b15b;--silver:#c0c0c0;--bronze:#cd7f32;--accent:#f2d675;
  --up:#16c784;--down:#ff5c5c;--no:#9aa3ad;--cpu:#ff6b6b;
  --win-bg:#143a29;--win-fg:#bff8d7;--loss-bg:#3f2629;--loss-fg:#ffd0d0;
  --chip:#121212;--chip-b:#2a2a2a;
  --btn-a:#1a1a1a;--btn-b:#262626;--btn-glow:#f2d67566
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
a{color:var(--gold);text-decoration:none}
a:focus-visible,.chip:focus-visible,.cta-btn:focus-visible{outline:2px solid var(--accent);outline-offset:2px;border-radius:10px}
h1,h2{margin:0 0 .6rem}
p{margin:.4rem 0 .8rem}
.small{font-size:.92rem;color:#b0b0b0}
.muted{color:var(--muted)}
.section{max-width:1100px;margin:0 auto;padding:18px 14px;scroll-margin-top:72px}
.card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px}
.hidden{display:none!important}
footer{max-width:1100px;margin:12px auto 40px;padding:0 14px;color:#aaa;font-size:.9rem}

/* Chips */
.chips{max-width:1100px;margin:10px auto 6px;padding:0 14px;display:flex;gap:8px;flex-wrap:wrap}
.chip{display:inline-block;padding:8px 12px;border-radius:999px;background:var(--chip);border:1px solid var(--chip-b);color:#eaeaea;font-weight:600}
.chip:hover{border-color:var(--accent);color:var(--accent)}

/* Ticker */
.ticker{position:sticky;top:0;z-index:999;background:linear-gradient(90deg,#121212,#181818);border-bottom:1px solid #1f1f1f}
.ticker .wrap{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:10px;padding:10px 14px;flex-wrap:wrap}
.ticker .logo-a{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:10px;background:linear-gradient(180deg,#f7e8a5,#d6b458 60%,#a3832c);color:#111;font-weight:900;letter-spacing:.6px;border:1px solid #caae51;box-shadow:0 0 0 2px #3c3210 inset, 0 2px 10px #0008}
.ticker .track{overflow:hidden;flex:1;min-width:280px}
.ticker .row{display:inline-flex;gap:28px;align-items:center;white-space:nowrap;animation:marquee 30s linear infinite}
.ticker:hover .row{animation-play-state:paused}
.ticker .row>*{font-weight:900;letter-spacing:.3px;position:relative;padding-right:36px;margin-right:36px}
.ticker .row>*::after{content:"";position:absolute;right:8px;top:50%;transform:translateY(-50%);width:6px;height:24px;background:linear-gradient(180deg,#f7e8a5,#d6b458 60%,#a3832c);border-radius:3px}
@keyframes marquee{from{transform:translateX(0)} to{transform:translateX(-50%)}}
.cta-btn{margin-left:8px;border:1px solid #3c3c3c;padding:8px 14px;border-radius:12px;color:#fff;background:linear-gradient(180deg,var(--btn-a),var(--btn-b));box-shadow:0 0 0 2px #000 inset, 0 0 18px var(--btn-glow);font-weight:800;letter-spacing:.2px}
.cta-btn:hover{filter:brightness(1.08);box-shadow:0 0 0 2px #000 inset,0 0 22px var(--btn-glow)}

/* Splash */
.splash{min-height:42vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;color:var(--accent);position:relative}
.splash h1{font-size:clamp(2rem,4.8vw,3rem)}
.splash-hero{width:min(100%,1100px);max-width:92vw;height:auto;margin:.75rem auto 0;border-radius:16px;border:1px solid #2a2a2a;box-shadow:0 10px 40px #000a}

/* Tables */
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #2a2a2a;padding:8px 10px;text-align:left;vertical-align:top}
.sortable th{user-select:none;cursor:pointer}
.sortable th[aria-sort="ascending"],.sortable th[aria-sort="descending"]{color:var(--accent)}
.cell-win{background:var(--win-bg);color:var(--win-fg);border-radius:6px;padding:3px 8px}
.cell-loss{background:var(--loss-bg);color:var(--loss-fg);border-radius:6px;padding:3px 8px}
.delta-up{color:var(--up);font-weight:700}
.delta-down{color:var(--down);font-weight:700}
.delta-none{color:var(--no)}
.cpu{color:var(--cpu);font-weight:700}

/* Badges + medals */
.badge{display:inline-block;border:1px solid #3a3a3a;background:#111;padding:2px 8px;border-radius:999px;font-size:.8rem;margin-left:8px}
.badge-uvu{border-color:#5151a3}
.badge-upset{border-color:#774040;color:#ffd0d0}
.gold{color:var(--gold);font-weight:900}
.silver{color:var(--silver);font-weight:900}
.bronze{color:var(--bronze);font-weight:900}

@media (max-width:560px){ .ticker .row>*{padding-right:20px;margin-right:20px} }
</style>
</head>
<body>

<!-- Ticker -->
<div class="ticker" role="region" aria-label="D1SN Headlines">
  <div class="wrap">
    <a href="https://professorzoom45.github.io/PTG/" class="logo-a" title="Home (Index)">D1SN</a>
    <div class="track"><div class="row" id="tickerRow"></div></div>
    <a class="cta-btn" href="https://professorzoom45.github.io/PTG/teamhub.html" title="Schools & Coaches (Team Pages)">Team Pages</a>
    <a class="cta-btn" href="mailto:changethewrldplz@gmail.com?subject=DM%20D1SN&body=Hey%20D1SN%2C%20" title="Email D1SN Directly">DM D1SN</a>
  </div>
</div>

<!-- Chips -->
<div class="chips">
  <a class="chip" href="#headline">Headline</a>
  <a class="chip" href="#power">Power Index</a>
  <a class="chip" href="#top25">Top-25 (Week 3 — Coaches)</a>
  <a class="chip" href="#week2">Week 2 — Finals</a>
  <a class="chip" href="#week3ip">Week 3 — In Progress</a>
  <a class="chip" href="#week4">Week 4 — Slate</a>
  <a class="chip" href="#gotw">Game of the Week</a>
  <a class="chip" href="#upsets">Upset Alert</a>
  <a class="chip" href="#conf">Conference Supremacy Tracker</a>
  <a class="chip" href="previous-schedules.html" title="Opens the archive (Weeks 0–2)">Previous Schedules</a>
  <a class="chip" href="https://professorzoom45.github.io/PTG/teamhub.html" title="Schools & Coaches Directory (Links To All 32 Team Pages)">Schools & Coaches</a>
  <a class="chip" href="#owners">Owners</a>
  <a class="chip" href="#mail">Mailbag</a>
</div>

<!-- Splash -->
<section class="splash">
  <h1>Running Late Dynasty — Week 3</h1>
  <img id="splashHero" class="splash-hero" alt="Week 3 Cover"
       src="https://professorzoom45.github.io/PTG/week3cover.png" />
</section>

<!-- Headline -->
<section id="headline" class="section">
  <h2>GOTW Shockwave: <strong>LSU</strong> drops <strong>USC</strong>, 42–13</h2>
  <div class="card">
    <p><strong>Death Valley</strong> roared and the Tigers answered. In our Game of the Week, <strong>LSU</strong> buried <strong>USC</strong> under a relentless 42–13 avalanche, scoring in every quarter and holding the Trojans to a single TD after halftime. It’s the signature win of the young season and a tone-setter for the user slate headed into Week 3.</p>
    <p class="small muted">Heads up: the Power Index below ranks only user teams; the Top-25 shows the single Week 3 (Coaches) poll as of the end of Week 2. User teams are bolded everywhere.</p>
  </div>
</section>

<!-- Power Index -->
<section id="power" class="section">
  <h2>Power Index</h2>
  <div class="card">
    <p class="small">User-only list (32 teams). Elo base 1500 with margin factor; CPU teams are excluded. Medals: <span class="gold">#1 Gold</span>, <span class="silver">#2 Silver</span>, <span class="bronze">#3 Bronze</span>.</p>
    <table class="table sortable" id="powerTable">
      <thead>
        <tr><th data-type="num">#</th><th data-type="str">Team</th><th data-type="num">Rating</th><th data-type="rec">Record</th></tr>
      </thead>
      <tbody id="powerBody"></tbody>
    </table>
  </div>
</section>

<!-- Top-25 -->
<section id="top25" class="section">
  <h2>Top-25 (Week 3 — Coaches)</h2>
  <div class="card">
    <p class="small">One poll only: Week 3 Coaches poll (standings after Week 2). User teams bolded anywhere they appear. <em>#1 overall</em> is highlighted in <span class="gold">gold</span>.</p>
    <table class="table sortable" id="pollTable">
      <thead>
        <tr><th data-type="num">#</th><th data-type="str">Team</th><th data-type="num">LW</th><th data-type="str">Δ</th><th data-type="rec">Record</th><th data-type="num">Pts</th></tr>
      </thead>
      <tbody id="pollBody"></tbody>
    </table>
    <div id="movers" class="small" style="margin-top:10px"></div>
  </div>
</section>

<!-- Week 2 -->
<section id="week2" class="section">
  <h2>Week 2 — Final Scores</h2>
  <div class="card">
    <table class="table sortable" id="wk2Table">
      <thead><tr><th data-type="str">Away</th><th data-type="num">A</th><th data-type="str">Home</th><th data-type="num">H</th><th data-type="str">Type</th></tr></thead>
      <tbody id="wk2Body"></tbody>
    </table>
  </div>
</section>

<!-- Week 3 — In Progress (Users Only: UvU & UvCPU) -->
<section id="week3ip" class="section">
  <h2>Week 3 — In Progress (Users Only)</h2>
  <div class="card">
    <table class="table sortable" id="wk3ipTable">
      <thead><tr><th data-type="str">Away</th><th data-type="num">A</th><th data-type="str">Home</th><th data-type="num">H</th><th data-type="str">Type</th></tr></thead>
      <tbody id="wk3ipBody"></tbody>
    </table>
  </div>
</section>

<!-- Game of the Week -->
<section id="gotw" class="section">
  <h2>Game of the Week <span class="badge badge-uvu">UvU</span></h2>
  <div class="card" id="gotwCard"></div>
</section>

<!-- Upset Alert (Week 2 Only) -->
<section id="upsets" class="section">
  <h2>Upset Alert <span class="badge badge-upset">Week 2 Only</span></h2>
  <div class="card">
    <ul id="upsetList" style="margin:0;padding-left:18px"></ul>
    <p class="small muted" id="upsetNote"></p>
  </div>
</section>

<!-- Conference Supremacy Tracker -->
<section id="conf" class="section">
  <h2>Conference Supremacy Tracker</h2>
  <div class="card">
    <p class="small">Counts <strong>only</strong> <em>User vs User</em> games from Weeks 0–2. Win% = Wins ÷ (Wins + Losses). Intra-conference UvU adds one win and one loss to the same conference.</p>
    <div id="confBlurb" class="small" style="margin-bottom:10px"></div>
    <div id="confTableWrap"></div>
  </div>
</section>

<!-- Week 4 — Slate (Image + GOTW Vote) -->
<section id="week4" class="section">
  <h2>Week 4 — User Games Slate</h2>
  <div class="card">
    <p class="small"><strong>Vote For Game Of The Week:</strong> <a href="https://discord.com/channels/1382826467683205180/1407980310158905448" target="_blank" rel="noopener">Discord Poll Link</a></p>
    <a href="https://professorzoom45.github.io/PTG/week4slate.jpg" target="_blank" rel="noopener">
      <img id="wk4Img" class="splash-hero" loading="lazy"
           src="https://professorzoom45.github.io/PTG/week4slate.jpg"
           alt="Week 4 User Games Slate">
    </a>
    <p id="wk4Fallback" class="small muted hidden">Trying alternate image name…</p>
  </div>
</section>

<!-- Owners -->
<section id="owners" class="section">
  <h2>Owners Directory (32)</h2>
  <div class="card">
    <table class="table sortable" id="ownersTable">
      <thead><tr><th data-type="str">Team</th><th data-type="str">Owner (Discord)</th><th data-type="str">Conf</th></tr></thead>
      <tbody id="ownersBody"></tbody>
    </table>
  </div>
</section>

<!-- Mailbag -->
<section id="mail" class="section">
  <h2>Mailbag & Submissions</h2>
  <div class="card">
    <p>Email <a href="mailto:changethewrldplz@gmail.com">changethewrldplz@gmail.com</a>, post in <a href="https://discord.com/channels/1382826467683205180/1382826468622467133" target="_blank" rel="noopener">Discord #general</a>, or click <a href="mailto:changethewrldplz@gmail.com">DM D1SN</a>.</p>
    <p class="muted">Submit top stat lines, highlights, or chaos moments; we’ll post them after verification.</p>
  </div>
</section>

<footer>© D1SN — Running Late Dynasty. Tip: press <kbd>Enter</kbd> on a table header to sort.</footer>

<script>
/* ===== User Teams / Owners / Conferences ===== */
const USER_TEAMS=["LSU","Clemson","Arkansas","Michigan","Texas","Ohio State","Miami","Delaware","Georgia","Arizona State","Florida","Washington","Alabama","BYU","Oklahoma","Florida State","Notre Dame","South Carolina","Illinois","USC","Texas Tech","Baylor","Colorado","Texas A&M","Penn State","Tennessee","North Carolina","Utah","Auburn","Minnesota","SMU","UCLA"];

const OWNER_MAP={
  "LSU":"@zo0o_0om","Clemson":"@selfmadezay.","Arkansas":"@streetcammo5391","Michigan":"@grap.12_58536",
  "Texas":"@i_do_dis_314","Ohio State":"@shadeeliteyt","Miami":"@imjusttoolucky","Delaware":"@sweatsuitsavage9225",
  "Georgia":"@mikecmd_856","Arizona State":"@partymaster84","Florida":"@lakedogg32","Washington":"@zeeeeeeeee3",
  "Alabama":"@lejason","BYU":"@yungdee0354","Oklahoma":"@illecill","Florida State":"@allstarcowboy254._84024",
  "Notre Dame":"@cjjman36","South Carolina":"@ulost2sway","Illinois":"@merzqcg","USC":"@flyguy3x",
  "Texas Tech":"@zig8875","Baylor":"@.ruin2.","Colorado":"@phreshttv","Texas A&M":"@dabears7712",
  "Penn State":"@jrob9179","Tennessee":"@cordfollowing9275","North Carolina":"@KingDion716","Utah":"@papishome69",
  "Auburn":"@slimxxiv","Minnesota":"@jayhibbs.","SMU":"@superhb","UCLA":"@dawgpd_31"
};

const TEAM_CONF={
  "Georgia":"SEC","Alabama":"SEC","LSU":"SEC","Texas":"SEC","Oklahoma":"SEC","Florida":"SEC","Tennessee":"SEC","Texas A&M":"SEC","South Carolina":"SEC","Arkansas":"SEC","Auburn":"SEC","Baylor":"SEC",
  "Ohio State":"Big Ten","Michigan":"Big Ten","Penn State":"Big Ten","USC":"Big Ten","UCLA":"Big Ten","Washington":"Big Ten","Minnesota":"Big Ten","Illinois":"Big Ten",
  "Clemson":"ACC","Florida State":"ACC","Miami":"ACC","North Carolina":"ACC","SMU":"ACC","Notre Dame":"ACC",
  "Colorado":"Big 12","Texas Tech":"Big 12","Utah":"Big 12","Arizona State":"Big 12","BYU":"Big 12","Delaware":"Big 12"
};

const isUser = t => USER_TEAMS.includes(t);

/* ===== Polls (Week 3 — Coaches final after Week 2) ===== */
const POLL_PRE=[[1,"Georgia"],[2,"Ohio State"],[3,"Notre Dame"],[4,"Texas"],[5,"Alabama"],[6,"North Carolina"],[7,"Miami"],[8,"Penn State"],[9,"LSU"],[10,"Clemson"],[11,"Minnesota"],[12,"USC"],[13,"Texas Tech"],[14,"Florida State"],[15,"Oklahoma"],[16,"Florida"],[17,"Washington"],[18,"Baylor"],[19,"Tennessee"],[20,"Texas A&M"],[21,"Colorado"],[22,"Arkansas"],[23,"BYU"],[24,"Utah"],[25,"Illinois"]];
const POLL_NOW=[
  [1,"Alabama",1503],[2,"Miami",1429],[3,"South Carolina",1318],[4,"Notre Dame",1280],[5,"North Carolina",1210],
  [6,"Ohio State",1182],[7,"Minnesota",1107],[8,"Penn State",1053],[9,"LSU",1011],[10,"Georgia",893],
  [11,"Texas",749],[12,"BYU",749],[13,"Washington",701],[14,"Colorado",644],[15,"Texas Tech",612],
  [16,"Michigan",523],[17,"SMU",512],[18,"Indiana",441],[19,"Oregon",399],[20,"Texas A&M",327],
  [21,"Baylor",326],[22,"Delaware",322],[23,"Utah",287],[24,"Arkansas",322],[25,"Florida",229]
];
const POLL_LW_OVERRIDES={}; // supply if needed

/* ===== Scores ===== */
const WEEK0_RESULTS=[ /* kept for ratings math only */ 
  {away:"Florida",a:27,home:"Washington",h:42},
  {away:"USC",a:7,home:"Texas",h:40},
  {away:"Ohio",a:3,home:"Ohio State",h:28},
  {away:"Illinois",a:0,home:"Texas Tech",h:28},
  {away:"Temple",a:20,home:"Penn State",h:57},
  {away:"Iowa",a:7,home:"Alabama",h:42},
  {away:"Indiana",a:24,home:"LSU",h:26},
  {away:"UCLA",a:10,home:"California",h:14},
  {away:"Michigan",a:20,home:"Houston",h:0},
  {away:"Utah",a:56,home:"Utah State",h:31},
  {away:"SMU",a:14,home:"Baylor",h:37},
  {away:"BYU",a:21,home:"Clemson",h:17},
  {away:"Miami",a:63,home:"Central Michigan",h:3}
];
const WEEK1_RESULTS=[ /* kept for ratings math only */
  {away:"Clemson",a:14,home:"LSU",h:31},
  {away:"Texas A&M",a:38,home:"Missouri State",h:3},
  {away:"Texas",a:48,home:"Texas State",h:3},
  {away:"California",a:44,home:"Tennessee",h:47},
  {away:"Arizona State",a:7,home:"South Carolina",h:20},
  {away:"Marshall",a:3,home:"Penn State",h:70},
  {away:"Michigan",a:35,home:"NC State",h:20},
  {away:"Georgia",a:26,home:"Miami",h:38},
  {away:"Florida State",a:38,home:"Ole Miss",h:24},
  {away:"Alabama",a:21,home:"Ohio State",h:14}
];

/* Week 2 finals (displayed) */
const WEEK2_RESULTS=[
  {away:"Maryland",a:13,home:"Washington",h:19},
  {away:"UCLA",a:31,home:"Kennesaw State",h:7},
  {away:"Texas Tech",a:43,home:"Oregon State",h:17},
  {away:"Wisconsin",a:9,home:"South Carolina",h:77},
  {away:"Oklahoma",a:10,home:"Michigan",h:24},
  {away:"NC State",a:7,home:"Miami",h:58},
  {away:"USC",a:13,home:"LSU",h:42},
  {away:"BYU",a:66,home:"Utah State",h:3},
  {away:"Auburn",a:17,home:"Army",h:7},
  {away:"Arizona State",a:31,home:"Texas A&M",h:13},
  {away:"Florida State",a:24,home:"Texas",h:21},
  {away:"Tennessee",a:28,home:"Indiana",h:35},
  {away:"Alabama",a:42,home:"California",h:17}
];

/* ========= Week 3 schedule (only user-involved rows will render) ========= */
const WEEK3_SCHEDULE = [
  "#9 LSU @ #13 BYU",
  "#1 Alabama @ Utah",
  "Delaware @ Georgia Tech",
  "#17 Colorado @ Northwestern",
  "#14 Texas A&M @ Houston",
  "Akron @ #10 Minnesota",
  "Buffalo @ #7 Penn State",
  "Illinois @ Wisconsin",
  "#15 Washington @ Washington State",
  "UCLA @ Tulane",
  "#19 Indiana @ #22 USC",
  "#23 Baylor @ #8 Ohio State",
  "#6 North Carolina @ Florida State",
  "Boston College @ Clemson",
  "Pittsburgh @ #20 SMU",
  "#2 Miami @ Syracuse",
  "#3 Notre Dame @ Duke",
  "Hawai'i @ Arizona State"
];

/* ===== Helpers ===== */
const allResults = ()=>WEEK0_RESULTS.concat(WEEK1_RESULTS,WEEK2_RESULTS);
const currentPollRank = new Map(POLL_NOW.map(([r,t])=>[t,r]));
const preRank = new Map(POLL_PRE.map(([r,t])=>[t,r]));

function makeSortable(table){
  if(!table) return;
  const ths=[...table.querySelectorAll('thead th')];
  ths.forEach((th,i)=>{
    th.setAttribute('aria-sort','none'); th.tabIndex=0;
    th.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' ') { e.preventDefault(); th.click(); }});
    th.addEventListener('click',()=>{
      const type=th.dataset.type||'str',tbody=table.tBodies[0],rows=[...tbody.rows];
      const dir=th.getAttribute('aria-sort')==='ascending'?'descending':'ascending';
      ths.forEach(x=>x.setAttribute('aria-sort','none')); th.setAttribute('aria-sort',dir);
      const parse=td=>{const v=td.textContent.trim(); if(type==='num') return +v.replace(/[^0-9.-]/g,'')||0;
        if(type==='rec'){const m=v.match(/(\d+)\s*-\s*(\d+)/); return m?(+m[1]*100-+m[2]):0;}
        return v.toLowerCase();};
      rows.sort((a,b)=>{const A=parse(a.cells[i]),B=parse(b.cells[i]); return (A<B? -1: A>B? 1: 0)*(dir==='ascending'?1:-1);});
      rows.forEach(r=>tbody.appendChild(r));
    });
  });
}

function buildRecordMap(){
  const m=new Map(), add=(t,wl)=>{const r=m.get(t)||{w:0,l:0}; r[wl]++; m.set(t,r);};
  allResults().forEach(g=>{
    const w=g.a>g.h ? g.away:g.home, l=g.a>g.h ? g.home:g.away;
    if(w) add(w,'w'); if(l) add(l,'l');
  });
  return m;
}

/* ===== Power Index (Elo, Users Only) ===== */
function computeElo(){
  const K=24;
  const R=new Map();
  const getR=t=>R.has(t)?R.get(t):1500;
  const setR=(t,v)=>R.set(t,v);

  USER_TEAMS.forEach(t=>setR(t,1500));
  allResults().forEach(g=>{ setR(g.away,getR(g.away)); setR(g.home,getR(g.home)); });

  allResults().forEach(g=>{
    const Ra=getR(g.away), Rb=getR(g.home);
    const Sa = g.a>g.h?1:0, Sb = 1-Sa;
    const Ea = 1/(1+Math.pow(10,(Rb-Ra)/400));
    const Eb = 1-Ea;
    const margin = Math.max(1, Math.log1p(Math.abs(g.a-g.h))/0.7);
    setR(g.away, Ra + K*margin*(Sa-Ea));
    setR(g.home, Rb + K*margin*(Sb-Eb));
  });

  const rec=buildRecordMap();
  return USER_TEAMS.map(t=>{
    const r=Math.round(getR(t));
    const rr=rec.get(t)||{w:0,l:0};
    return {t, r, w:rr.w||0, l:rr.l||0};
  }).sort((a,b)=> b.r-a.r);
}
function renderPower(){
  const rows=computeElo();
  const body=document.getElementById('powerBody');
  body.innerHTML=rows.map((x,i)=>{
    const medalCls = i===0?'gold':i===1?'silver':i===2?'bronze':'';
    const teamCell = medalCls ? `<span class="${medalCls}"><strong>${x.t}</strong></span>` : `<strong>${x.t}</strong>`;
    return `<tr><td>${i+1}</td><td>${teamCell}</td><td>${x.r}</td><td>${x.w}-${x.l}</td></tr>`;
  }).join('');
  makeSortable(document.getElementById('powerTable'));
}

/* ===== Poll Render (Coaches; #1 Gold) ===== */
function renderPoll(){
  const rec=buildRecordMap();
  const preMap=new Map(POLL_PRE.map(([rk,t])=>[t,rk]));

  const now=POLL_NOW.map(([rk,t,pts])=>{
    const wl=rec.get(t)||{w:0,l:0};
    const lwOverride=POLL_LW_OVERRIDES[t];
    const baseLW=(typeof lwOverride==='number')?lwOverride:(preMap.has(t)?preMap.get(t):'NR');
    const base=(typeof baseLW==='number')?baseLW:null;
    const delta=(base!==null)?(base-rk):null;
    const dCls=delta===null?'delta-none':delta>0?'delta-up':delta<0?'delta-down':'delta-none';
    const deltaTxt=delta===null?'NR':(delta===0?'—':(delta>0?`▲ ${delta}`:`▼ ${Math.abs(delta)}`));
    return {rk,t,pts,lw:baseLW,delta,wl:`${wl.w||0}-${wl.l||0}`,dCls,deltaTxt};
  });

  const body=document.getElementById('pollBody');
  body.innerHTML=now.map(x=>{
    const isNo1=x.rk===1;
    const name = isNo1?`<span class="gold">${x.t}</span>`:x.t;
    return `<tr><td>${x.rk}</td><td>${name}</td><td>${x.lw}</td><td class="${x.dCls}">${x.deltaTxt}</td><td>${x.wl}</td><td>${x.pts}</td></tr>`;
  }).join('');

  const risers=now.filter(x=>x.delta!==null&&x.delta>=3).sort((a,b)=>b.delta-a.delta).slice(0,5);
  const fallers=now.filter(x=>x.delta!==null&&x.delta<=-3).sort((a,b)=>a.delta-b.delta).slice(0,5);
  const entrants=now.filter(x=>x.lw==='NR'||x.lw==='—').map(x=>`#${x.rk} ${x.t}`);
  const dropped=POLL_PRE.map(p=>p[1]).filter(t=>!now.find(n=>n.t===t)).map(t=>`#${preMap.get(t)} ${t}`);

  document.getElementById('movers').innerHTML =
    `<p><strong>Big Risers:</strong> ${risers.map(x=>`#${x.rk} ${x.t} (▲${x.delta})`).join(', ')||'—'}</p>
     <p><strong>Big Fallers:</strong> ${fallers.map(x=>`#${x.rk} ${x.t} (▼${Math.abs(x.delta)})`).join(', ')||'—'}</p>
     <p><strong>New Entrants:</strong> ${entrants.join(', ')||'—'}</p>
     <p><strong>Dropped Out:</strong> ${dropped.join(', ')||'—'}</p>`;
  makeSortable(document.getElementById('pollTable'));
}

/* ===== Matchup Parsing & Week 3 In-Progress ===== */
function parseMatchup(str){
  const clean=s=>s.replace(/^\s*#\d+\s*/,'').trim();
  let a='',b='', ar=null, br=null;
  const rxRank=/#(\d+)/g; const ranks=[...str.matchAll(rxRank)].map(m=>+m[1]);
  if(str.includes(' @ ')) [a,b]=str.split(' @ ').map(clean);
  else if(str.includes(' at ')) [a,b]=str.split(' at ').map(clean);
  else if(str.includes(' vs ')) [a,b]=str.split(' vs ').map(clean);
  else { a=str.trim(); b=''; }
  if(ranks.length){ ar=ranks[0]??null; br=ranks[1]??null; }
  return {a,b,ar,br,raw:str};
}
function matchupType(a,b){
  const aU=isUser(a), bU=isUser(b);
  if(aU&&bU) return 'User vs User';
  if(aU^bU)  return 'User vs CPU';
  return 'CPU vs CPU';
}
function renderWeek3InProgress(){
  const body=document.getElementById('wk3ipBody');
  const rows=WEEK3_SCHEDULE.map(x=>parseMatchup(x));
  const filtered=rows.filter(({a,b})=>matchupType(a,b)!=='CPU vs CPU');
  body.innerHTML = filtered.map(({a,b})=>{
    const A=isUser(a)?`<strong>${a}</strong>`:a;
    const H=isUser(b)?`<strong>${b}</strong>`:b;
    return `<tr><td>${A}</td><td>—</td><td>${H}</td><td>—</td><td>${matchupType(a,b)}</td></tr>`;
  }).join('') || `<tr><td colspan="5" class="small muted">No user-involved games found in the Week 3 slate.</td></tr>`;
  makeSortable(document.getElementById('wk3ipTable'));
}

/* ===== GOTW ===== */
function gotwScore(m){
  const {a,b,ar,br}=parseMatchup(m);
  const uvu=isUser(a)&&isUser(b);
  const ranked=(ar&&ar<=25)&&(br&&br<=25);
  const sum=(ar||50)+(br||50);
  return (uvu?1000:0)+(ranked?500:0)+(50-sum);
}
function renderGOTW(){
  const candidates=WEEK3_SCHEDULE.filter(Boolean);
  const filtered=candidates.filter(s=>matchupType(...Object.values(parseMatchup(s)).slice(0,2))!=='CPU vs CPU');
  if(!filtered.length){
    document.getElementById('gotwCard').innerHTML=`<p class="small muted">Add Week 3 schedule above to auto-select a GOTW (prefers ranked UvU).</p>`;
    return;
  }
  const best=filtered.slice().sort((x,y)=>gotwScore(y)-gotwScore(x))[0];
  const {a,b,ar,br}=parseMatchup(best);
  const rec=buildRecordMap(), ra=rec.get(a)||{w:0,l:0}, rb=rec.get(b)||{w:0,l:0};
  const notes=[];
  if(isUser(a)&&isUser(b)) notes.push('User vs User');
  if(ar&&br){ const top=Math.min(ar,br); notes.push(top<=5?'Top-5 Matchup':top<=10?'Top-10 Matchup':'Top-25 Matchup'); }
  document.getElementById('gotwCard').innerHTML =
    `<p><strong>${ar?`#${ar} `:''}${a}</strong> @ <strong>${br?`#${br} `:''}${b}</strong> <span class="badge badge-uvu">${notes.join(' • ')||'—'}</span></p>
     <p class="small">Records So Far: ${isUser(a)?`<strong>${a}</strong>`:a} ${ra.w}-${ra.l} • ${isUser(b)?`<strong>${b}</strong>`:b} ${rb.w}-${rb.l}</p>
     <p class="small"><strong>Vote Here:</strong> <a href="https://discord.com/channels/1382826467683205180/1407980310158905448" target="_blank" rel="noopener">Discord GOTW Poll</a></p>`;
}

/* ===== Upset Alert (Week 2 Only) ===== */
function findWeek2Upsets(){
  const games=WEEK2_RESULTS;
  const upsets=[];
  games.forEach(g=>{
    const winner=g.a>g.h?g.away:g.home;
    const loser=g.a>g.h?g.home:g.away;
    const wr=preRank.get(winner)??99;
    const lr=preRank.get(loser)??99;
    const wScore=Math.max(g.a,g.h), lScore=Math.min(g.a,g.h);
    if(lr<wr || (wr===99&&lr<=25)){
      upsets.push({winner,loser,wr:(wr===99?'NR':wr),lr,wScore,lScore});
    }
  });
  return upsets;
}
function renderUpsets(){
  const list=document.getElementById('upsetList');
  const arr=findWeek2Upsets();
  if(!arr.length){
    list.innerHTML='<li class="small muted">No Week 2 upsets listed yet.</li>';
    document.getElementById('upsetNote').textContent='This section only shows upsets from Week 2 finals. An upset = higher-ranked team lost to a lower-ranked or unranked opponent.';
    return;
  }
  list.innerHTML=arr.map(u=>{
    const W=isUser(u.winner)?`<strong>${u.winner}</strong>`:u.winner;
    const L=isUser(u.loser)?`<strong>${u.loser}</strong>`:u.loser;
    return `<li>${W} (${u.wr}) def. ${L} (#${u.lr}) ${u.wScore}–${u.lScore}</li>`;
  }).join('');
  document.getElementById('upsetNote').textContent='Using preseason ranks as baseline (replace with Week 3 poll if desired).';
}

/* ===== Conference Supremacy Tracker (UvU Only) ===== */
function getUserVsUserGames(){ return allResults().filter(g=>isUser(g.away)&&isUser(g.home)); }
function computeUvUConferenceStats(){
  const stats={};
  USER_TEAMS.forEach(t=>{const c=TEAM_CONF[t]||'Ind'; if(!stats[c]) stats[c]={w:0,l:0,gp:0,teams:{}}; stats[c].teams[t]={w:0,l:0};});
  getUserVsUserGames().forEach(g=>{
    const winner=g.a>g.h?g.away:g.home, loser=g.a>g.h?g.home:g.away;
    const wConf=TEAM_CONF[winner]||'Ind', lConf=TEAM_CONF[loser]||'Ind';
    stats[wConf].w++; stats[wConf].gp++; stats[lConf].l++; stats[lConf].gp++;
    stats[wConf].teams[winner].w++; stats[lConf].teams[loser].l++;
  });
  return Object.entries(stats).map(([conf,d])=>{
    const pct=d.gp?d.w/(d.w+d.l):0;
    const teams=Object.entries(d.teams).sort((a,b)=>{
      const [ta,ra]=a,[tb,rb]=b;
      if(ra.w!==rb.w) return rb.w-ra.w;
      if(ra.l!==rb.l) return ra.l-rb.l;
      const pa=currentPollRank.get(ta)||99, pb=currentPollRank.get(tb)||99;
      return pa-pb;
    });
    const leaderTeam=teams.find(([,r])=>r.w>0||r.l>0)?.[0]||teams[0][0];
    const leaderRec=d.teams[leaderTeam];
    return {conf,w:d.w,l:d.l,gp:d.gp,pct,leader:`${leaderTeam} (${leaderRec.w}-${leaderRec.l})`,raw:d};
  }).sort((a,b)=> b.pct-a.pct || b.w-a.w);
}
function renderConferenceTracker(){
  const rows=computeUvUConferenceStats();
  const wrap=document.getElementById('confTableWrap');
  const tbl=document.createElement('table');
  tbl.className='table sortable';
  tbl.innerHTML=`<thead>
    <tr><th data-type="num">Place</th><th data-type="str">Conference</th><th data-type="num">W</th><th data-type="num">L</th><th data-type="num">Win%</th><th data-type="str">Leader</th></tr>
  </thead><tbody></tbody>`;
  const tb=tbl.tBodies[0];
  rows.forEach((r,i)=>{
    const leaderHtml=r.leader.replace(/^[^ ]+/, t => (isUser(t)? `<strong>${t}</strong>` : t));
    tb.insertAdjacentHTML('beforeend',`<tr>
      <td>${i+1}</td><td>${r.conf}</td><td>${r.w}</td><td>${r.l}</td><td>${(r.pct*100).toFixed(1)}</td><td>${leaderHtml}</td>
    </tr>`);
  });
  wrap.innerHTML=''; wrap.appendChild(tbl); makeSortable(tbl);

  const top=rows[0];
  if(top){
    const confName=top.conf;
    const uvus=getUserVsUserGames().filter(g=>{
      const aC=TEAM_CONF[g.away], hC=TEAM_CONF[g.home];
      return aC===confName || hC===confName;
    });
    const wins=uvus.filter(g=> (TEAM_CONF[g.a>g.h?g.away:g.home])===confName)
      .map(g=>{const W=g.a>g.h?g.away:g.home, L=g.a>g.h?g.home:g.away, w=Math.max(g.a,g.h), l=Math.min(g.a,g.h);
        return `${isUser(W)?`<strong>${W}</strong>`:W} ${w}–${l} over ${isUser(L)?`<strong>${L}</strong>`:L}`;});
    document.getElementById('confBlurb').innerHTML =
      `<strong>${confName}</strong> leads at <strong>${top.w}-${top.l}</strong> (${(top.pct*100).toFixed(1)}%). 
       Pace-setter: ${wins.length?wins[0].split(' ')[0]:'—'}. Recent ${confName} UvU wins: <em>${wins.join(' • ')||'—'}</em>.`;
  }
}

/* ===== Generic Week Table Renderer (bolds user teams) ===== */
function renderWeek(tblId,bodyId,games){
  const body=document.getElementById(bodyId);
  if(!games.length){ return; }
  body.innerHTML=games.map(g=>{
    const awayWin=g.a>g.h, type=(isUser(g.away)&&isUser(g.home))?'User vs User':(isUser(g.away)||isUser(g.home))?'User vs CPU':'CPU vs CPU';
    const A=isUser(g.away)?`<strong>${g.away}</strong>`:g.away;
    const H=isUser(g.home)?`<strong>${g.home}</strong>`:g.home;
    return `<tr>
      <td class="${awayWin?'cell-win':'cell-loss'}">${A}</td>
      <td class="${awayWin?'cell-win':'cell-loss'}">${g.a}</td>
      <td class="${!awayWin?'cell-win':'cell-loss'}">${H}</td>
      <td class="${!awayWin?'cell-win':'cell-loss'}">${g.h}</td>
      <td>${type}</td>
    </tr>`;
  }).join('');
  makeSortable(document.getElementById(tblId));
}

/* ===== Owners ===== */
function renderOwners(){
  const body=document.getElementById('ownersBody');
  body.innerHTML=USER_TEAMS.slice().sort((a,b)=>a.localeCompare(b)).map(t=>{
    const conf=TEAM_CONF[t]||'Ind';
    const owner=OWNER_MAP[t]||'—';
    return `<tr><td><strong>${t}</strong></td><td>${owner}</td><td>${conf}</td></tr>`;
  }).join('');
  makeSortable(document.getElementById('ownersTable'));
}

/* ===== Ticker (Week 2 key results + GOTW) ===== */
function renderTicker(){
  const row=document.getElementById('tickerRow');
  const highlights=[
    "GOTW: LSU 42–13 USC",
    "Alabama 42–17 California",
    "BYU 66–3 Utah State",
    "Texas Tech 43–17 Oregon State",
    "Miami 58–7 NC State",
    "Washington 19–13 Maryland",
    "Florida State 24–21 Texas",
    "Utah 42–33 Arkansas",
    "Indiana 35–28 Tennessee",
    "Auburn 17–7 Army",
    "UCLA 31–7 Kennesaw St.",
    "Arizona State 31–13 Texas A&M",
    "Michigan 24–10 Oklahoma",
    "South Carolina 77–9 Wisconsin"
  ];
  row.innerHTML=highlights.map(txt=>`<span>${txt}</span>`).join('');
}

/* ===== Bold All User Teams (Global) ===== */
function boldUserTeamsEverywhere(){
  const SKIP=new Set(['SCRIPT','STYLE','CODE','PRE','TEXTAREA']);
  const teams=USER_TEAMS.slice().sort((a,b)=>b.length-a.length);
  const patterns=teams.map(t=>({t,re:new RegExp(`(^|[^A-Za-z])(${t.replace(/[-/\\^$*+?.()|[\]{}]/g,'\\$&')})(?=$|[^A-Za-z])`,'g')}));
  const walker=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{
    acceptNode(node){
      const p=node.parentElement;
      if(!p||SKIP.has(p.tagName)||p.closest('strong')) return NodeFilter.FILTER_REJECT;
      if(!node.nodeValue||!node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
      return NodeFilter.FILTER_ACCEPT;
    }
  });
  const nodes=[]; while(walker.nextNode()) nodes.push(walker.currentNode);
  nodes.forEach(tn=>{
    let s=tn.nodeValue, changed=false;
    patterns.forEach(({re})=>{ s=s.replace(re,(_,pre,match)=>{changed=true;return `${pre}<strong>${match}</strong>`;}); });
    if(changed){ const span=document.createElement('span'); span.innerHTML=s; tn.parentNode.replaceChild(span,tn); }
  });
}

/* ===== Image Fallbacks ===== */
function setupHeroFallback(){
  const hero=document.getElementById('splashHero');
  if(!hero) return;
  hero.addEventListener('error',()=>{
    if(!hero.getAttribute('data-tried-alt')){
      hero.setAttribute('data-tried-alt','1');
      hero.src=hero.src.endsWith('.png')?hero.src.replace('.png','.PNG'):hero.src.replace('.PNG','.png');
    }
  });
}
function setupWeek4SlateFallback(){
  const img=document.getElementById('wk4Img');
  const msg=document.getElementById('wk4Fallback');
  if(!img) return;
  img.addEventListener('error',()=>{
    const tried=img.getAttribute('data-tried-alt')||'';
    let next=null;
    if(tried===''){ next=img.src.replace(/\.jpg$/i,'.jpeg'); img.setAttribute('data-tried-alt','jpeg'); }
    else if(tried==='jpeg'){ next=img.src.replace(/\.jpeg$/i,'.png'); img.setAttribute('data-tried-alt','png'); }
    else if(tried==='png'){ next=img.src.toUpperCase(); img.setAttribute('data-tried-alt','upper'); }
    else { msg?.classList.remove('hidden'); msg.textContent='Couldn’t load Week 4 slate image.'; return; }
    msg?.classList.remove('hidden'); msg.textContent='Trying alternate image name…';
    img.src=next;
  });
}

/* ===== Boot ===== */
function boot(){
  renderTicker();
  renderPower();
  renderPoll();
  renderWeek('wk2Table','wk2Body',WEEK2_RESULTS);
  renderWeek3InProgress();
  renderGOTW();
  renderUpsets();
  renderConferenceTracker();
  renderOwners();
  setupHeroFallback();
  setupWeek4SlateFallback();
  boldUserTeamsEverywhere();
}
document.addEventListener('DOMContentLoaded', boot);
</script>
</body>
    </html>
